<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="generator" content="Hugo 0.58.3" />
    
    <link rel="stylesheet" href="https://javifm.com/beta/css/styles.css">
    
    
    <title>Arbol de intervalos (interval tree) en Javascript | Frontend developer</title>
    <style>
    .testing {
      max-width: 700px;
    }
</style>

  </head>

  <body>
    <div class="bg-gray-100 prefers-dark:bg-gray-900 border-t-4 border-green-500">
    <div class="container mx-auto">
        <nav class="flex p-6">
            
            
            
            
            
            
            
                
            

            <a class="mr-6 p-2 text-gray-700 hover:text-green-500 prefers-dark:hover:text-red-500 prefers-dark:focus:text-white uppercase " href="/beta/">Inicio</a>
            
            
            
            
            
                
            

            <a class="mr-6 p-2 text-gray-700 hover:text-green-500 prefers-dark:hover:text-red-500 prefers-dark:focus:text-white uppercase active" href="/beta/blog/">Blog</a>
            
            
            
            
            
                
            

            <a class="mr-6 p-2 text-gray-700 hover:text-green-500 prefers-dark:hover:text-red-500 prefers-dark:focus:text-white uppercase " href="/beta/tags/">Tags</a>
            
            
            
            
            
                
            

            <a class="mr-6 p-2 text-gray-700 hover:text-green-500 prefers-dark:hover:text-red-500 prefers-dark:focus:text-white uppercase " href="/beta/sobre-mi/">Sobre mí</a>
            
        </nav>
    </div>
</div>

    
      <main id="main">
       

<div class="container mx-auto px-4 single-post">
    <div class="my-6">
        <h1 class="title">Arbol de intervalos (interval tree) en Javascript</h1>
        

<div class="flex flex-wrap items-center text-gray-600">
    <time datetime="2016-09-09">
        Publicado el 9 Sep 2016</time>
    
    <span>
        <span class="mx-2">&bull;</span>Tiempo de lectura: 13min
    </span>
    
</div>

    <div class="mt-4">
        
            
            <a class="tag inline-block text-sm mr-2 mb-2" href="https://javifm.com/beta/tags/algoritmos">algoritmos</a>
        
            
            <a class="tag inline-block text-sm mr-2 mb-2" href="https://javifm.com/beta/tags/javascript">javascript</a>
        
    </div>


    </div>
    <div class="single-post-content">
        <p>Continúo aprendiendo cosas en mi proyecto laboral actual. En este caso, para <strong>optimizar el rendimiento de una búsqueda en un objeto enorme en Javascript.</strong> El problema es el siguiente, se han de encontrar los nodos que pertenecen a un intervalo dado. En este caso en concreto, se dispone de una lista de canales de televisión, para los cuales disponemos de todos los programas, relativos a varios días de programación.</p>

<p>En los navegadores de hoy en día, como Google Chrome o cualquier navegador medianamente moderno, <strong>no habría excesivos problemas en iterar por fuerza bruta</strong> hasta encontrar todos los eventos cuya fecha de inicio y fin se encontrase dentro del intervalo (ojo, para nada digo que sea lo más óptimo ni recomendado). Los problemas pueden llegar cuando en el target del proyecto podemos encontrar televisiones Smart TV´s antiguas y/o de gama baja, que vienen <strong>más justas de memoria.</strong></p>

<p>Además, no es un escenario normal, en mi caso los datos se encuentran en formato binario, y es necesario realizar una descodificación antes de saber si un determinado programa de un canal está dentro del rango horario buscado o no. Para ello podemos elaborar un <a href="https://es.wikipedia.org/wiki/%C3%81rbol_de_intervalo">árbol de intervalos,</a> algo bastante sencillo de hacer en lenguajes como Java, pero más díficil en Javascript. Por suerte, siempre <strong>podemos encontrar librerías y código de terceros</strong> que ya haya resuelto este y otros algoritmos para Javascript, en este caso yo he utilizado ésta librería, <a href="https://github.com/shinout/interval-tree2">interval-tree2.</a></p>

<p>Su uso es muy sencillo, tal y como describen en su sitio de Github. En nuestro proyecto utilizamos <strong>RequireJS</strong> como cargador de módulos, asi que adapté los distintos ficheros y los convertí en módulos. Si no tienes ni idea de <a href="http://coffeescript.org/">CoffeeScript</a> (lenguaje que compila a Javascript), ni de como compilarlo, puedes instalarte el paquete por npm, que es lo que hice yo y de ahí cogí los ficheros js.</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">npm install interval-tree2</code></pre></div>

<p>En la carpeta <em>dist</em> se encuentran los ficheros necesarios:</p>

<ul>
<li>interval.js</li>
<li>interval-tree.js</li>
<li>node.js</li>
<li>point.js</li>
<li>sorted-list.js</li>
<li>util.js</li>
</ul>

<p>Yo he cogido todos, los he modificado para usarlos en entorno web, pongo el código al final de la entrada. Siguiendo el ejemplo puesto por el autor. Para crear un árbol y añadir intervalos:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-JavaScript" data-lang="JavaScript"><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">itree</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">IntervalTree</span>(<span style="color:#ae81ff">300</span>); <span style="color:#75715e">// 300 : Centro del árbol
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// &#39;foo&#39; es el identificador del intervalo
</span><span style="color:#75715e"></span><span style="color:#a6e22e">itree</span>.<span style="color:#a6e22e">add</span>(<span style="color:#ae81ff">22</span>, <span style="color:#ae81ff">56</span>, <span style="color:#e6db74">&#39;foo&#39;</span>);

<span style="color:#75715e">// &#39;bar&#39; es el identificador del intervalo
</span><span style="color:#75715e"></span><span style="color:#a6e22e">itree</span>.<span style="color:#a6e22e">add</span>(<span style="color:#ae81ff">44</span>, <span style="color:#ae81ff">199</span>, <span style="color:#e6db74">&#39;bar&#39;</span>);

<span style="color:#75715e">// Si no se pone id, se asigna automaticamente uno
</span><span style="color:#75715e"></span><span style="color:#a6e22e">itree</span>.<span style="color:#a6e22e">add</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">38</span>);
</code></pre></div>

<p>Una vez insertados los intervalos, a la hora de buscar disponemos de 2 métodos:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-JavaScript" data-lang="JavaScript"><span style="color:#75715e">// Intervalos que coinciden con un punto
</span><span style="color:#75715e"></span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">intervals</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">itree</span>.<span style="color:#a6e22e">pointSearch</span>(<span style="color:#ae81ff">103</span>);

<span style="color:#75715e">// Intervalos que entran en el rango solicitado
</span><span style="color:#75715e"></span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">intervals2</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">itree</span>.<span style="color:#a6e22e">rangeSearch</span>(<span style="color:#ae81ff">103</span>, <span style="color:#ae81ff">400</span>);
</code></pre></div>

<p>Una vez obtenidos, se pueden recorrer todos los intervalos:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-JavaScript" data-lang="JavaScript"><span style="color:#a6e22e">intervals2</span>.<span style="color:#a6e22e">forEach</span>(<span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">interval</span>) {
<span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">interval</span>.<span style="color:#a6e22e">start</span>); <span style="color:#75715e">// Posición de inicio
</span><span style="color:#75715e"></span><span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">interval</span>.<span style="color:#a6e22e">end</span>); <span style="color:#75715e">// Posición de fin
</span><span style="color:#75715e"></span><span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">interval</span>.<span style="color:#a6e22e">id</span>); <span style="color:#75715e">// ID
</span><span style="color:#75715e"></span>});
</code></pre></div>

<p>Por último, se puede eliminar un intervalo dado su id:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-JavaScript" data-lang="JavaScript"><span style="color:#a6e22e">itree</span>.<span style="color:#a6e22e">remove</span>(<span style="color:#e6db74">&#39;foo&#39;</span>);
</code></pre></div>

<p>En mi caso, encontré especialmente útil el id de cada intervalo, pues lo usaba para obtener información de la posición dentro del binario donde poder buscar la información de cada programa. Cada canal de televisión dispone de su árbol, y cada evento tenía un id de este estilo:</p>

<p>dia_deprogramacion|posicion_binario</p>

<p>Ejemplo: &#8220;5|250&#8221;</p>

<p>Aquí está todo el código de seguido, en formato módulos de Javascript, listo para importar y comenzar a usarse en entorno web.</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-JavaScript" data-lang="JavaScript"><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">Node</span> <span style="color:#f92672">=</span> ( <span style="color:#66d9ef">function</span>() {

       <span style="color:#75715e">/**
</span><span style="color:#75715e">       @constructor
</span><span style="color:#75715e">       @param {Number} center center of the node
</span><span style="color:#75715e">        */</span>
       <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">Node</span>( <span style="color:#a6e22e">center</span> ) {
           <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">center</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">center</span>;

           <span style="color:#75715e">/**
</span><span style="color:#75715e">           another node whose center is less than this.center
</span><span style="color:#75715e">    
</span><span style="color:#75715e">           @property {Node} left
</span><span style="color:#75715e">            */</span>
           <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">left</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;

           <span style="color:#75715e">/**
</span><span style="color:#75715e">           another node whose center is greater than this.center
</span><span style="color:#75715e">    
</span><span style="color:#75715e">           @property {Node} right
</span><span style="color:#75715e">            */</span>
           <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">right</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;

           <span style="color:#75715e">/**
</span><span style="color:#75715e">           sorted list of Intervals, sorting them by their start property
</span><span style="color:#75715e">    
</span><span style="color:#75715e">           @property {SortedList(Interval)} starts
</span><span style="color:#75715e">            */</span>
           <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">starts</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">SortedList</span>( <span style="color:#e6db74">&#39;start&#39;</span> );

           <span style="color:#75715e">/**
</span><span style="color:#75715e">           sorted list of Intervals, sorting them by their end property
</span><span style="color:#75715e">    
</span><span style="color:#75715e">           @property {SortedList(Interval)} ends
</span><span style="color:#75715e">            */</span>
           <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">ends</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">SortedList</span>( <span style="color:#e6db74">&#39;end&#39;</span> );
       }


       <span style="color:#75715e">/**
</span><span style="color:#75715e">       the number of intervals
</span><span style="color:#75715e">  
</span><span style="color:#75715e">       @method count
</span><span style="color:#75715e">       @return {Number}
</span><span style="color:#75715e">        */</span>

       <span style="color:#a6e22e">Node</span>.<span style="color:#a6e22e">prototype</span>.<span style="color:#a6e22e">count</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>() {
           <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">starts</span>.<span style="color:#a6e22e">length</span>;
       };


       <span style="color:#75715e">/**
</span><span style="color:#75715e">       insert an interval
</span><span style="color:#75715e">  
</span><span style="color:#75715e">       @method insert
</span><span style="color:#75715e">       @param {Interval} interval
</span><span style="color:#75715e">        */</span>

       <span style="color:#a6e22e">Node</span>.<span style="color:#a6e22e">prototype</span>.<span style="color:#a6e22e">insert</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>( <span style="color:#a6e22e">interval</span> ) {
           <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">starts</span>.<span style="color:#a6e22e">insert</span>( <span style="color:#a6e22e">interval</span> );
           <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">ends</span>.<span style="color:#a6e22e">insert</span>( <span style="color:#a6e22e">interval</span> );
       };


       <span style="color:#75715e">/**
</span><span style="color:#75715e">       get intervals whose start position is less than or equal to the given value
</span><span style="color:#75715e">  
</span><span style="color:#75715e">       @method startPointSearch
</span><span style="color:#75715e">       @param {Number} val
</span><span style="color:#75715e">       @return {Array(Interval)}
</span><span style="color:#75715e">        */</span>

       <span style="color:#a6e22e">Node</span>.<span style="color:#a6e22e">prototype</span>.<span style="color:#a6e22e">startPointSearch</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>( <span style="color:#a6e22e">val</span> ) {
           <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">index</span>;
           <span style="color:#a6e22e">index</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">starts</span>.<span style="color:#a6e22e">lastPositionOf</span>( {
               <span style="color:#a6e22e">start</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">val</span>
           } );
           <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">starts</span>.<span style="color:#a6e22e">slice</span>( <span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">index</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span> );
       };


       <span style="color:#75715e">/**
</span><span style="color:#75715e">       get intervals whose end position is more than or equal to the given value
</span><span style="color:#75715e">  
</span><span style="color:#75715e">       @method endPointSearch
</span><span style="color:#75715e">       @param {Number} val
</span><span style="color:#75715e">       @return {Array(Interval)}
</span><span style="color:#75715e">        */</span>

       <span style="color:#a6e22e">Node</span>.<span style="color:#a6e22e">prototype</span>.<span style="color:#a6e22e">endPointSearch</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>( <span style="color:#a6e22e">val</span> ) {
           <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">index</span>;
           <span style="color:#a6e22e">index</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">ends</span>.<span style="color:#a6e22e">firstPositionOf</span>( {
               <span style="color:#a6e22e">end</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">val</span>
           } );
           <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">ends</span>.<span style="color:#a6e22e">slice</span>( <span style="color:#a6e22e">index</span> );
       };


       <span style="color:#75715e">/**
</span><span style="color:#75715e">       gets all registered interval
</span><span style="color:#75715e">  
</span><span style="color:#75715e">       @method getAllIntervals
</span><span style="color:#75715e">       @return {Array(Interval)}
</span><span style="color:#75715e">        */</span>

       <span style="color:#a6e22e">Node</span>.<span style="color:#a6e22e">prototype</span>.<span style="color:#a6e22e">getAllIntervals</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>() {
           <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">starts</span>.<span style="color:#a6e22e">toArray</span>();
       };


       <span style="color:#75715e">/**
</span><span style="color:#75715e">       remove the given interval
</span><span style="color:#75715e">  
</span><span style="color:#75715e">       @method remove
</span><span style="color:#75715e">       @param {Interval} interval
</span><span style="color:#75715e">       @param {SortedList} list
</span><span style="color:#75715e">        */</span>

       <span style="color:#a6e22e">Node</span>.<span style="color:#a6e22e">prototype</span>.<span style="color:#a6e22e">remove</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>( <span style="color:#a6e22e">interval</span> ) {
           <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">removeFromList</span>( <span style="color:#a6e22e">interval</span>, <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">starts</span> );
           <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">removeFromList</span>( <span style="color:#a6e22e">interval</span>, <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">ends</span> );
       };


       <span style="color:#75715e">/**
</span><span style="color:#75715e">       remove the given interval from the given list
</span><span style="color:#75715e">  
</span><span style="color:#75715e">       @method removeFromList
</span><span style="color:#75715e">       @private
</span><span style="color:#75715e">       @param {Interval} interval
</span><span style="color:#75715e">       @param {SortedList} list
</span><span style="color:#75715e">        */</span>

       <span style="color:#a6e22e">Node</span>.<span style="color:#a6e22e">prototype</span>.<span style="color:#a6e22e">removeFromList</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>( <span style="color:#a6e22e">interval</span>, <span style="color:#a6e22e">list</span> ) {
           <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">candidate</span>, <span style="color:#a6e22e">firstPos</span>, <span style="color:#a6e22e">i</span>, <span style="color:#a6e22e">idx</span>, <span style="color:#a6e22e">ref</span>, <span style="color:#a6e22e">ref1</span>, <span style="color:#a6e22e">results</span>;
           <span style="color:#a6e22e">firstPos</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>.<span style="color:#a6e22e">firstPositionOf</span>( <span style="color:#a6e22e">interval</span> );
           <span style="color:#a6e22e">results</span> <span style="color:#f92672">=</span> [];
           <span style="color:#66d9ef">for</span> ( <span style="color:#a6e22e">idx</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">ref</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">firstPos</span>, <span style="color:#a6e22e">ref1</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>.<span style="color:#a6e22e">length</span>; <span style="color:#a6e22e">ref</span> <span style="color:#f92672">&lt;=</span> <span style="color:#a6e22e">ref1</span> <span style="color:#f92672">?</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">ref1</span> <span style="color:#f92672">:</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">ref1</span>; <span style="color:#a6e22e">idx</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">ref</span> <span style="color:#f92672">&lt;=</span> <span style="color:#a6e22e">ref1</span> <span style="color:#f92672">?</span> <span style="color:#f92672">++</span><span style="color:#a6e22e">i</span> <span style="color:#f92672">:</span> <span style="color:#f92672">--</span><span style="color:#a6e22e">i</span> ) {
               <span style="color:#a6e22e">candidate</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>[ <span style="color:#a6e22e">idx</span> ];
               <span style="color:#66d9ef">if</span> ( <span style="color:#a6e22e">candidate</span>.<span style="color:#a6e22e">id</span> <span style="color:#f92672">===</span> <span style="color:#a6e22e">interval</span>.<span style="color:#a6e22e">id</span> ) {
                   <span style="color:#a6e22e">list</span>.<span style="color:#a6e22e">remove</span>( <span style="color:#a6e22e">idx</span> );
                   <span style="color:#66d9ef">break</span>;
               }
               <span style="color:#66d9ef">else</span> {
                   <span style="color:#a6e22e">results</span>.<span style="color:#a6e22e">push</span>( <span style="color:#66d9ef">void</span> <span style="color:#ae81ff">0</span> );
               }
           }
           <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">results</span>;
       };

       <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">Node</span>;

   } )();

   <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">Interval</span>;

   <span style="color:#a6e22e">Interval</span> <span style="color:#f92672">=</span> ( <span style="color:#66d9ef">function</span>() {

       <span style="color:#75715e">/**
</span><span style="color:#75715e">       @constructor
</span><span style="color:#75715e">       @param {Number} start start of the interval
</span><span style="color:#75715e">       @param {Number} end end of the interval
</span><span style="color:#75715e">       @param {Number|String} id id of the interval
</span><span style="color:#75715e">        */</span>
       <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">Interval</span>( <span style="color:#a6e22e">start</span>, <span style="color:#a6e22e">end</span>, <span style="color:#a6e22e">id</span> ) {
           <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">start</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">start</span>;
           <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">end</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">end</span>;
           <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">id</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">id</span>;
       }


       <span style="color:#75715e">/**
</span><span style="color:#75715e">       get center of the interval
</span><span style="color:#75715e">      
</span><span style="color:#75715e">       @method center
</span><span style="color:#75715e">       @return {Number} center
</span><span style="color:#75715e">        */</span>

       <span style="color:#a6e22e">Interval</span>.<span style="color:#a6e22e">prototype</span>.<span style="color:#a6e22e">center</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>() {
           <span style="color:#66d9ef">return</span> ( <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">start</span> <span style="color:#f92672">+</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">end</span> ) <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>;
       };

       <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">Interval</span>;

   } )();

   <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">IntervalTree</span> <span style="color:#f92672">=</span> ( <span style="color:#66d9ef">function</span>() {

       <span style="color:#75715e">/**
</span><span style="color:#75715e">       @constructor
</span><span style="color:#75715e">       @param {Number} center center of the root node
</span><span style="color:#75715e">        */</span>
       <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">IntervalTree</span>( <span style="color:#a6e22e">center</span> ) {
           <span style="color:#a6e22e">Util</span>.<span style="color:#a6e22e">assertNumber</span>( <span style="color:#a6e22e">center</span>, <span style="color:#e6db74">&#39;IntervalTree: center&#39;</span> );

           <span style="color:#75715e">/**
</span><span style="color:#75715e">           center =&gt; node
</span><span style="color:#75715e">    
</span><span style="color:#75715e">           @property {Object(Node)} nodesByCenter
</span><span style="color:#75715e">            */</span>
           <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">nodesByCenter</span> <span style="color:#f92672">=</span> {};

           <span style="color:#75715e">/**
</span><span style="color:#75715e">           root node
</span><span style="color:#75715e">    
</span><span style="color:#75715e">           @property {Node} root
</span><span style="color:#75715e">            */</span>
           <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">root</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">createNode</span>( <span style="color:#a6e22e">center</span> );

           <span style="color:#75715e">/**
</span><span style="color:#75715e">           interval id =&gt; interval
</span><span style="color:#75715e">    
</span><span style="color:#75715e">           @property {Object(Interval)} intervalsById
</span><span style="color:#75715e">            */</span>
           <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">intervalsById</span> <span style="color:#f92672">=</span> {};

           <span style="color:#75715e">/**
</span><span style="color:#75715e">           interval id =&gt; node
</span><span style="color:#75715e">    
</span><span style="color:#75715e">           @property {Object(Node)} nodesById
</span><span style="color:#75715e">            */</span>
           <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">nodesById</span> <span style="color:#f92672">=</span> {};

           <span style="color:#75715e">/**
</span><span style="color:#75715e">           sorted list of whole point
</span><span style="color:#75715e">    
</span><span style="color:#75715e">           @property {SortedList(Point)} pointTree
</span><span style="color:#75715e">            */</span>
           <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">pointTree</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">SortedList</span>( <span style="color:#e6db74">&#39;val&#39;</span> );

           <span style="color:#75715e">/**
</span><span style="color:#75715e">           unique id candidate of interval without id to be added next time
</span><span style="color:#75715e">    
</span><span style="color:#75715e">           @property {Number} idCandidate
</span><span style="color:#75715e">            */</span>
           <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">idCandidate</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
       }


       <span style="color:#75715e">/**
</span><span style="color:#75715e">       add one interval
</span><span style="color:#75715e">  
</span><span style="color:#75715e">       @method add
</span><span style="color:#75715e">       @public
</span><span style="color:#75715e">       @param {Number} start start of the interval to create
</span><span style="color:#75715e">       @param {Number} end   end of the interval to create
</span><span style="color:#75715e">       @param {String|Number} [id] identifier to distinguish intervals. Automatically defiend when not set.
</span><span style="color:#75715e">       @return {Interval}
</span><span style="color:#75715e">        */</span>

       <span style="color:#a6e22e">IntervalTree</span>.<span style="color:#a6e22e">prototype</span>.<span style="color:#a6e22e">add</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>( <span style="color:#a6e22e">start</span>, <span style="color:#a6e22e">end</span>, <span style="color:#a6e22e">id</span> ) {
           <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">interval</span>;
           <span style="color:#66d9ef">if</span> ( <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">intervalsById</span>[ <span style="color:#a6e22e">id</span> ] <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span> ) {
               <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> Error( <span style="color:#e6db74">&#39;id &#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">id</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39; is already registered.&#39;</span> );
           }
           <span style="color:#66d9ef">if</span> ( <span style="color:#a6e22e">id</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span> ) {
               <span style="color:#66d9ef">while</span> ( <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">intervalsById</span>[ <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">idCandidate</span> ] <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span> ) {
                   <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">idCandidate</span><span style="color:#f92672">++</span>;
               }
               <span style="color:#a6e22e">id</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">idCandidate</span>;
           }
           <span style="color:#a6e22e">Util</span>.<span style="color:#a6e22e">assertNumber</span>( <span style="color:#a6e22e">start</span>, <span style="color:#e6db74">&#39;1st argument of IntervalTree#add()&#39;</span> );
           <span style="color:#a6e22e">Util</span>.<span style="color:#a6e22e">assertNumber</span>( <span style="color:#a6e22e">end</span>, <span style="color:#e6db74">&#39;2nd argument of IntervalTree#add()&#39;</span> );
           <span style="color:#66d9ef">if</span> ( <span style="color:#a6e22e">start</span> <span style="color:#f92672">&gt;=</span> <span style="color:#a6e22e">end</span> ) {
               <span style="color:#a6e22e">Util</span>.<span style="color:#a6e22e">assertOrder</span>( <span style="color:#a6e22e">start</span>, <span style="color:#a6e22e">end</span>, <span style="color:#e6db74">&#39;start&#39;</span>, <span style="color:#e6db74">&#39;end&#39;</span> );
           }
           <span style="color:#a6e22e">interval</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Interval</span>( <span style="color:#a6e22e">start</span>, <span style="color:#a6e22e">end</span>, <span style="color:#a6e22e">id</span> );
           <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">pointTree</span>.<span style="color:#a6e22e">insert</span>( <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Point</span>( <span style="color:#a6e22e">interval</span>.<span style="color:#a6e22e">start</span>, <span style="color:#a6e22e">id</span> ) );
           <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">pointTree</span>.<span style="color:#a6e22e">insert</span>( <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Point</span>( <span style="color:#a6e22e">interval</span>.<span style="color:#a6e22e">end</span>, <span style="color:#a6e22e">id</span> ) );
           <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">intervalsById</span>[ <span style="color:#a6e22e">id</span> ] <span style="color:#f92672">=</span> <span style="color:#a6e22e">interval</span>;
           <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">insert</span>( <span style="color:#a6e22e">interval</span>, <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">root</span> );
       };


       <span style="color:#75715e">/**
</span><span style="color:#75715e">       search intervals
</span><span style="color:#75715e">       when only one argument is given, return intervals which contains the value
</span><span style="color:#75715e">       when two arguments are given, ...
</span><span style="color:#75715e">  
</span><span style="color:#75715e">       @method search
</span><span style="color:#75715e">       @public
</span><span style="color:#75715e">       @param {Number} val1
</span><span style="color:#75715e">       @param {Number} val2
</span><span style="color:#75715e">       @return {Array(Interval)} intervals
</span><span style="color:#75715e">        */</span>

       <span style="color:#a6e22e">IntervalTree</span>.<span style="color:#a6e22e">prototype</span>.<span style="color:#a6e22e">search</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>( <span style="color:#a6e22e">val1</span>, <span style="color:#a6e22e">val2</span> ) {
           <span style="color:#a6e22e">Util</span>.<span style="color:#a6e22e">assertNumber</span>( <span style="color:#a6e22e">val1</span>, <span style="color:#e6db74">&#39;1st argument at IntervalTree#search()&#39;</span> );
           <span style="color:#66d9ef">if</span> ( <span style="color:#a6e22e">val2</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span> ) {
               <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">pointSearch</span>( <span style="color:#a6e22e">val1</span> );
           }
           <span style="color:#66d9ef">else</span> {
               <span style="color:#a6e22e">Util</span>.<span style="color:#a6e22e">assertNumber</span>( <span style="color:#a6e22e">val2</span>, <span style="color:#e6db74">&#39;2nd argument at IntervalTree#search()&#39;</span> );
               <span style="color:#a6e22e">Util</span>.<span style="color:#a6e22e">assertOrder</span>( <span style="color:#a6e22e">val1</span>, <span style="color:#a6e22e">val2</span>, <span style="color:#e6db74">&#39;1st argument&#39;</span>, <span style="color:#e6db74">&#39;2nd argument&#39;</span>, <span style="color:#e6db74">&#39;IntervalTree#search()&#39;</span> );
               <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">rangeSearch</span>( <span style="color:#a6e22e">val1</span>, <span style="color:#a6e22e">val2</span> );
           }
       };


       <span style="color:#75715e">/**
</span><span style="color:#75715e">       removes an interval of the given id
</span><span style="color:#75715e">  
</span><span style="color:#75715e">       @method remove
</span><span style="color:#75715e">       @public
</span><span style="color:#75715e">       @param {Number|String} id id of the interval to remove
</span><span style="color:#75715e">        */</span>

       <span style="color:#a6e22e">IntervalTree</span>.<span style="color:#a6e22e">prototype</span>.<span style="color:#a6e22e">remove</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>( <span style="color:#a6e22e">id</span> ) {
           <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">interval</span>, <span style="color:#a6e22e">node</span>;
           <span style="color:#a6e22e">interval</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">intervalsById</span>[ <span style="color:#a6e22e">id</span> ];
           <span style="color:#66d9ef">if</span> ( <span style="color:#a6e22e">interval</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span> ) {
               <span style="color:#66d9ef">return</span>;
           }
           <span style="color:#a6e22e">node</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">nodesById</span>[ <span style="color:#a6e22e">id</span> ];
           <span style="color:#a6e22e">node</span>.<span style="color:#a6e22e">remove</span>( <span style="color:#a6e22e">interval</span> );
           <span style="color:#66d9ef">delete</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">nodesById</span>[ <span style="color:#a6e22e">id</span> ];
           <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">delete</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">intervalsById</span>[ <span style="color:#a6e22e">id</span> ];
       };


       <span style="color:#75715e">/**
</span><span style="color:#75715e">       search intervals at the given node
</span><span style="color:#75715e">  
</span><span style="color:#75715e">       @method pointSearch
</span><span style="color:#75715e">       @public
</span><span style="color:#75715e">       @param {Number} val
</span><span style="color:#75715e">       @param {Node} [node] current node to search. default is this.root
</span><span style="color:#75715e">       @return {Array(Interval)}
</span><span style="color:#75715e">        */</span>

       <span style="color:#a6e22e">IntervalTree</span>.<span style="color:#a6e22e">prototype</span>.<span style="color:#a6e22e">pointSearch</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>( <span style="color:#a6e22e">val</span>, <span style="color:#a6e22e">node</span>, <span style="color:#a6e22e">results</span> ) {
           <span style="color:#66d9ef">if</span> ( <span style="color:#a6e22e">node</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span> ) {
               <span style="color:#a6e22e">node</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">root</span>;
           }
           <span style="color:#66d9ef">if</span> ( <span style="color:#a6e22e">results</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span> ) {
               <span style="color:#a6e22e">results</span> <span style="color:#f92672">=</span> [];
           }
           <span style="color:#a6e22e">Util</span>.<span style="color:#a6e22e">assertNumber</span>( <span style="color:#a6e22e">val</span>, <span style="color:#e6db74">&#39;1st argument of IntervalTree#pointSearch()&#39;</span> );
           <span style="color:#66d9ef">if</span> ( <span style="color:#a6e22e">val</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">node</span>.<span style="color:#a6e22e">center</span> ) {
               <span style="color:#a6e22e">results</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">results</span>.<span style="color:#a6e22e">concat</span>( <span style="color:#a6e22e">node</span>.<span style="color:#a6e22e">startPointSearch</span>( <span style="color:#a6e22e">val</span> ) );
               <span style="color:#66d9ef">if</span> ( <span style="color:#a6e22e">node</span>.<span style="color:#a6e22e">left</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span> ) {
                   <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">pointSearch</span>( <span style="color:#a6e22e">val</span>, <span style="color:#a6e22e">node</span>.<span style="color:#a6e22e">left</span>, <span style="color:#a6e22e">results</span> );
               }
               <span style="color:#66d9ef">else</span> {
                   <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">results</span>;
               }
           }
           <span style="color:#66d9ef">if</span> ( <span style="color:#a6e22e">val</span> <span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">node</span>.<span style="color:#a6e22e">center</span> ) {
               <span style="color:#a6e22e">results</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">results</span>.<span style="color:#a6e22e">concat</span>( <span style="color:#a6e22e">node</span>.<span style="color:#a6e22e">endPointSearch</span>( <span style="color:#a6e22e">val</span> ) );
               <span style="color:#66d9ef">if</span> ( <span style="color:#a6e22e">node</span>.<span style="color:#a6e22e">right</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span> ) {
                   <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">pointSearch</span>( <span style="color:#a6e22e">val</span>, <span style="color:#a6e22e">node</span>.<span style="color:#a6e22e">right</span>, <span style="color:#a6e22e">results</span> );
               }
               <span style="color:#66d9ef">else</span> {
                   <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">results</span>;
               }
           }
           <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">results</span>.<span style="color:#a6e22e">concat</span>( <span style="color:#a6e22e">node</span>.<span style="color:#a6e22e">getAllIntervals</span>() );
       };


       <span style="color:#75715e">/**
</span><span style="color:#75715e">       returns intervals which covers the given start-end interval
</span><span style="color:#75715e">  
</span><span style="color:#75715e">       @method rangeSearch
</span><span style="color:#75715e">       @public
</span><span style="color:#75715e">       @param {Number} start start of the interval
</span><span style="color:#75715e">       @param {Number} end end of the interval
</span><span style="color:#75715e">       @return {Array(Interval)}
</span><span style="color:#75715e">        */</span>

       <span style="color:#a6e22e">IntervalTree</span>.<span style="color:#a6e22e">prototype</span>.<span style="color:#a6e22e">rangeSearch</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>( <span style="color:#a6e22e">start</span>, <span style="color:#a6e22e">end</span> ) {
           <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">firstPos</span>, <span style="color:#a6e22e">i</span>, <span style="color:#a6e22e">id</span>, <span style="color:#a6e22e">interval</span>, <span style="color:#a6e22e">j</span>, <span style="color:#a6e22e">lastPos</span>, <span style="color:#a6e22e">len</span>, <span style="color:#a6e22e">len1</span>, <span style="color:#a6e22e">point</span>, <span style="color:#a6e22e">ref</span>, <span style="color:#a6e22e">ref1</span>, <span style="color:#a6e22e">resultsById</span>;
           <span style="color:#a6e22e">Util</span>.<span style="color:#a6e22e">assertNumber</span>( <span style="color:#a6e22e">start</span>, <span style="color:#e6db74">&#39;1st argument at IntervalTree#rangeSearch()&#39;</span> );
           <span style="color:#a6e22e">Util</span>.<span style="color:#a6e22e">assertNumber</span>( <span style="color:#a6e22e">end</span>, <span style="color:#e6db74">&#39;2nd argument at IntervalTree#rangeSearch()&#39;</span> );
           <span style="color:#a6e22e">Util</span>.<span style="color:#a6e22e">assertOrder</span>( <span style="color:#a6e22e">start</span>, <span style="color:#a6e22e">end</span>, <span style="color:#e6db74">&#39;1st argument&#39;</span>, <span style="color:#e6db74">&#39;2nd argument&#39;</span>, <span style="color:#e6db74">&#39;IntervalTree#rangeSearch()&#39;</span> );
           <span style="color:#a6e22e">resultsById</span> <span style="color:#f92672">=</span> {};
           <span style="color:#a6e22e">ref</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">pointSearch</span>( <span style="color:#a6e22e">start</span> );
           <span style="color:#66d9ef">for</span> ( <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">len</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">ref</span>.<span style="color:#a6e22e">length</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">len</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span> ) {
               <span style="color:#a6e22e">interval</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">ref</span>[ <span style="color:#a6e22e">i</span> ];
               <span style="color:#a6e22e">resultsById</span>[ <span style="color:#a6e22e">interval</span>.<span style="color:#a6e22e">id</span> ] <span style="color:#f92672">=</span> <span style="color:#a6e22e">interval</span>;
           }
           <span style="color:#a6e22e">firstPos</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">pointTree</span>.<span style="color:#a6e22e">firstPositionOf</span>( <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Point</span>( <span style="color:#a6e22e">start</span> ) );
           <span style="color:#a6e22e">lastPos</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">pointTree</span>.<span style="color:#a6e22e">lastPositionOf</span>( <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Point</span>( <span style="color:#a6e22e">end</span> ) );
           <span style="color:#a6e22e">ref1</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">pointTree</span>.<span style="color:#a6e22e">slice</span>( <span style="color:#a6e22e">firstPos</span>, <span style="color:#a6e22e">lastPos</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span> );
           <span style="color:#66d9ef">for</span> ( <span style="color:#a6e22e">j</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">len1</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">ref1</span>.<span style="color:#a6e22e">length</span>; <span style="color:#a6e22e">j</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">len1</span>; <span style="color:#a6e22e">j</span><span style="color:#f92672">++</span> ) {
               <span style="color:#a6e22e">point</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">ref1</span>[ <span style="color:#a6e22e">j</span> ];
               <span style="color:#a6e22e">resultsById</span>[ <span style="color:#a6e22e">point</span>.<span style="color:#a6e22e">id</span> ] <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">intervalsById</span>[ <span style="color:#a6e22e">point</span>.<span style="color:#a6e22e">id</span> ];
           }
           <span style="color:#66d9ef">return</span> ( <span style="color:#66d9ef">function</span>() {
               <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">results1</span>;
               <span style="color:#a6e22e">results1</span> <span style="color:#f92672">=</span> [];
               <span style="color:#66d9ef">for</span> ( <span style="color:#a6e22e">id</span> <span style="color:#66d9ef">in</span> <span style="color:#a6e22e">resultsById</span> ) {
                   <span style="color:#a6e22e">interval</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">resultsById</span>[ <span style="color:#a6e22e">id</span> ];
                   <span style="color:#a6e22e">results1</span>.<span style="color:#a6e22e">push</span>( <span style="color:#a6e22e">interval</span> );
               }
               <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">results1</span>;
           } )();
       };


       <span style="color:#75715e">/**
</span><span style="color:#75715e">       insert interval to the given node
</span><span style="color:#75715e">  
</span><span style="color:#75715e">       @method insert
</span><span style="color:#75715e">       @private
</span><span style="color:#75715e">       @param {Interval} interval
</span><span style="color:#75715e">       @param {Node} node node to insert the interval
</span><span style="color:#75715e">       @return {Interval} inserted interval
</span><span style="color:#75715e">        */</span>

       <span style="color:#a6e22e">IntervalTree</span>.<span style="color:#a6e22e">prototype</span>.<span style="color:#a6e22e">insert</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>( <span style="color:#a6e22e">interval</span>, <span style="color:#a6e22e">node</span> ) {
           <span style="color:#66d9ef">if</span> ( <span style="color:#a6e22e">interval</span>.<span style="color:#a6e22e">end</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">node</span>.<span style="color:#a6e22e">center</span> ) {
               <span style="color:#66d9ef">if</span> ( <span style="color:#a6e22e">node</span>.<span style="color:#a6e22e">left</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span> ) {
                   <span style="color:#a6e22e">node</span>.<span style="color:#a6e22e">left</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">createNode</span>( <span style="color:#a6e22e">interval</span>.<span style="color:#a6e22e">end</span> );
               }
               <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">insert</span>( <span style="color:#a6e22e">interval</span>, <span style="color:#a6e22e">node</span>.<span style="color:#a6e22e">left</span> );
           }
           <span style="color:#66d9ef">if</span> ( <span style="color:#a6e22e">node</span>.<span style="color:#a6e22e">center</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">interval</span>.<span style="color:#a6e22e">start</span> ) {
               <span style="color:#66d9ef">if</span> ( <span style="color:#a6e22e">node</span>.<span style="color:#a6e22e">right</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span> ) {
                   <span style="color:#a6e22e">node</span>.<span style="color:#a6e22e">right</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">createNode</span>( <span style="color:#a6e22e">interval</span>.<span style="color:#a6e22e">start</span> );
               }
               <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">insert</span>( <span style="color:#a6e22e">interval</span>, <span style="color:#a6e22e">node</span>.<span style="color:#a6e22e">right</span> );
           }
           <span style="color:#a6e22e">node</span>.<span style="color:#a6e22e">insert</span>( <span style="color:#a6e22e">interval</span> );
           <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">nodesById</span>[ <span style="color:#a6e22e">interval</span>.<span style="color:#a6e22e">id</span> ] <span style="color:#f92672">=</span> <span style="color:#a6e22e">node</span>;
           <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">interval</span>;
       };


       <span style="color:#75715e">/**
</span><span style="color:#75715e">       create node by center
</span><span style="color:#75715e">  
</span><span style="color:#75715e">       @method createNode
</span><span style="color:#75715e">       @private
</span><span style="color:#75715e">       @param {Number} center
</span><span style="color:#75715e">       @return {Node} node
</span><span style="color:#75715e">        */</span>

       <span style="color:#a6e22e">IntervalTree</span>.<span style="color:#a6e22e">prototype</span>.<span style="color:#a6e22e">createNode</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>( <span style="color:#a6e22e">center</span> ) {
           <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">node</span>;
           <span style="color:#a6e22e">node</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Node</span>( <span style="color:#a6e22e">center</span> );
           <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">nodesByCenter</span>[ <span style="color:#a6e22e">center</span> ] <span style="color:#f92672">=</span> <span style="color:#a6e22e">node</span>;
           <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">node</span>;
       };

       <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">IntervalTree</span>;

   } )();


   <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">Util</span>;

   <span style="color:#a6e22e">Util</span> <span style="color:#f92672">=</span> ( <span style="color:#66d9ef">function</span>() {
       <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">Util</span>() {}

       <span style="color:#a6e22e">Util</span>.<span style="color:#a6e22e">assertNumber</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>( <span style="color:#a6e22e">val</span>, <span style="color:#a6e22e">desc</span> ) {
           <span style="color:#66d9ef">if</span> ( <span style="color:#a6e22e">val</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span> ) {
               <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> Error( <span style="color:#a6e22e">desc</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39; is required.&#39;</span> );
           }
           <span style="color:#66d9ef">if</span> ( <span style="color:#66d9ef">typeof</span> <span style="color:#a6e22e">val</span> <span style="color:#f92672">!==</span> <span style="color:#e6db74">&#39;number&#39;</span> ) {
               <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> Error( <span style="color:#a6e22e">desc</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39; must be a number.&#39;</span> );
           }
       };

       <span style="color:#a6e22e">Util</span>.<span style="color:#a6e22e">assertOrder</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>( <span style="color:#a6e22e">start</span>, <span style="color:#a6e22e">end</span>, <span style="color:#a6e22e">startName</span>, <span style="color:#a6e22e">endName</span>, <span style="color:#a6e22e">desc</span> ) {
           <span style="color:#66d9ef">if</span> ( <span style="color:#a6e22e">start</span> <span style="color:#f92672">&gt;=</span> <span style="color:#a6e22e">end</span> ) {
               <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> Error( <span style="color:#a6e22e">desc</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;: &#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">startName</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;(&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">start</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;) must be smaller than &#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">endName</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;(&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">end</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;).&#34;</span> );
           }
       };

       <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">Util</span>;

   } )();

   <span style="color:#75715e">/**
</span><span style="color:#75715e">   extended array of objects, always sorted
</span><span style="color:#75715e">
</span><span style="color:#75715e">   @class SortedList
</span><span style="color:#75715e">   @extends Array
</span><span style="color:#75715e">   @module interval-tree2
</span><span style="color:#75715e">    */</span>
   <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">SortedList</span>,
       <span style="color:#a6e22e">extend</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>( <span style="color:#a6e22e">child</span>, <span style="color:#a6e22e">parent</span> ) {
           <span style="color:#66d9ef">for</span> ( <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">key</span> <span style="color:#66d9ef">in</span> <span style="color:#a6e22e">parent</span> ) {
               <span style="color:#66d9ef">if</span> ( <span style="color:#a6e22e">hasProp</span>.<span style="color:#a6e22e">call</span>( <span style="color:#a6e22e">parent</span>, <span style="color:#a6e22e">key</span> ) ) <span style="color:#a6e22e">child</span>[ <span style="color:#a6e22e">key</span> ] <span style="color:#f92672">=</span> <span style="color:#a6e22e">parent</span>[ <span style="color:#a6e22e">key</span> ];
           }

           <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">ctor</span>() {
               <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">constructor</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">child</span>;
           }
           <span style="color:#a6e22e">ctor</span>.<span style="color:#a6e22e">prototype</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">parent</span>.<span style="color:#a6e22e">prototype</span>;
           <span style="color:#a6e22e">child</span>.<span style="color:#a6e22e">prototype</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">ctor</span>();
           <span style="color:#a6e22e">child</span>.<span style="color:#a6e22e">__super__</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">parent</span>.<span style="color:#a6e22e">prototype</span>;
           <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">child</span>;
       },
       <span style="color:#a6e22e">hasProp</span> <span style="color:#f92672">=</span> {}.<span style="color:#a6e22e">hasOwnProperty</span>;

   <span style="color:#a6e22e">SortedList</span> <span style="color:#f92672">=</span> ( <span style="color:#66d9ef">function</span>( <span style="color:#a6e22e">superClass</span> ) {
       <span style="color:#a6e22e">extend</span>( <span style="color:#a6e22e">SortedList</span>, <span style="color:#a6e22e">superClass</span> );


       <span style="color:#75715e">/**
</span><span style="color:#75715e">       @constructor
</span><span style="color:#75715e">       @param {String} compareKey key name to compare objects. The value of the key must be a number.
</span><span style="color:#75715e">        */</span>


       <span style="color:#75715e">/**
</span><span style="color:#75715e">       key name to compare objects. The value of the key must be a number.
</span><span style="color:#75715e">       @property {String} compareKey
</span><span style="color:#75715e">        */</span>

       <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">SortedList</span>( <span style="color:#a6e22e">compareKey</span> ) {
           <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">compareKey</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">compareKey</span>;
       }


       <span style="color:#75715e">/**
</span><span style="color:#75715e">       insert a value
</span><span style="color:#75715e">      
</span><span style="color:#75715e">       @method insert
</span><span style="color:#75715e">       @param {any} val
</span><span style="color:#75715e">       @return {Number} inserted position
</span><span style="color:#75715e">        */</span>

       <span style="color:#a6e22e">SortedList</span>.<span style="color:#a6e22e">prototype</span>.<span style="color:#a6e22e">insert</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>( <span style="color:#a6e22e">val</span> ) {
           <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">pos</span>;
           <span style="color:#a6e22e">pos</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">bsearch</span>( <span style="color:#a6e22e">val</span> );
           <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">splice</span>( <span style="color:#a6e22e">pos</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">val</span> );
           <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">pos</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>;
       };


       <span style="color:#75715e">/**
</span><span style="color:#75715e">       remove the value in the given position
</span><span style="color:#75715e">      
</span><span style="color:#75715e">       @method remove
</span><span style="color:#75715e">       @param {Number} pos position
</span><span style="color:#75715e">       @return {SortedList} self
</span><span style="color:#75715e">        */</span>

       <span style="color:#a6e22e">SortedList</span>.<span style="color:#a6e22e">prototype</span>.<span style="color:#a6e22e">remove</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>( <span style="color:#a6e22e">pos</span> ) {
           <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">splice</span>( <span style="color:#a6e22e">pos</span>, <span style="color:#ae81ff">1</span> );
           <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>;
       };


       <span style="color:#75715e">/**
</span><span style="color:#75715e">       get maximum value in the list
</span><span style="color:#75715e">      
</span><span style="color:#75715e">       @method max
</span><span style="color:#75715e">       @return {Number}
</span><span style="color:#75715e">        */</span>

       <span style="color:#a6e22e">SortedList</span>.<span style="color:#a6e22e">prototype</span>.<span style="color:#a6e22e">max</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>() {
           <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">ref</span>;
           <span style="color:#66d9ef">return</span> ( <span style="color:#a6e22e">ref</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>[ <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span> ] ) <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">?</span> <span style="color:#a6e22e">ref</span>[ <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">compareKey</span> ] <span style="color:#f92672">:</span> <span style="color:#66d9ef">void</span> <span style="color:#ae81ff">0</span>;
       };


       <span style="color:#75715e">/**
</span><span style="color:#75715e">       get minimum value in the list
</span><span style="color:#75715e">      
</span><span style="color:#75715e">       @method min
</span><span style="color:#75715e">       @return {Number}
</span><span style="color:#75715e">        */</span>

       <span style="color:#a6e22e">SortedList</span>.<span style="color:#a6e22e">prototype</span>.<span style="color:#a6e22e">min</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>() {
           <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">ref</span>;
           <span style="color:#66d9ef">return</span> ( <span style="color:#a6e22e">ref</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>[ <span style="color:#ae81ff">0</span> ] ) <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">?</span> <span style="color:#a6e22e">ref</span>[ <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">compareKey</span> ] <span style="color:#f92672">:</span> <span style="color:#66d9ef">void</span> <span style="color:#ae81ff">0</span>;
       };


       <span style="color:#75715e">/**
</span><span style="color:#75715e">       binary search
</span><span style="color:#75715e">      
</span><span style="color:#75715e">       @method bsearch
</span><span style="color:#75715e">       @param {any} val
</span><span style="color:#75715e">       @return {Number} position of the value
</span><span style="color:#75715e">        */</span>

       <span style="color:#a6e22e">SortedList</span>.<span style="color:#a6e22e">prototype</span>.<span style="color:#a6e22e">bsearch</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>( <span style="color:#a6e22e">val</span> ) {
           <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">comp</span>, <span style="color:#a6e22e">epos</span>, <span style="color:#a6e22e">mpos</span>, <span style="color:#a6e22e">mval</span>, <span style="color:#a6e22e">spos</span>;
           <span style="color:#66d9ef">if</span> ( <span style="color:#f92672">!</span><span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">length</span> ) {
               <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
           }
           <span style="color:#a6e22e">mpos</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
           <span style="color:#a6e22e">mval</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
           <span style="color:#a6e22e">spos</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
           <span style="color:#a6e22e">epos</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">length</span>;
           <span style="color:#66d9ef">while</span> ( <span style="color:#a6e22e">epos</span> <span style="color:#f92672">-</span> <span style="color:#a6e22e">spos</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span> ) {
               <span style="color:#a6e22e">mpos</span> <span style="color:#f92672">=</span> Math.<span style="color:#a6e22e">floor</span>( ( <span style="color:#a6e22e">spos</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">epos</span> ) <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span> );
               <span style="color:#a6e22e">mval</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>[ <span style="color:#a6e22e">mpos</span> ];
               <span style="color:#a6e22e">comp</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">compare</span>( <span style="color:#a6e22e">val</span>, <span style="color:#a6e22e">mval</span> );
               <span style="color:#66d9ef">if</span> ( <span style="color:#a6e22e">comp</span> <span style="color:#f92672">===</span> <span style="color:#ae81ff">0</span> ) {
                   <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">mpos</span>;
               }
               <span style="color:#66d9ef">if</span> ( <span style="color:#a6e22e">comp</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span> ) {
                   <span style="color:#a6e22e">spos</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">mpos</span>;
               }
               <span style="color:#66d9ef">else</span> {
                   <span style="color:#a6e22e">epos</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">mpos</span>;
               }
           }
           <span style="color:#66d9ef">if</span> ( <span style="color:#a6e22e">spos</span> <span style="color:#f92672">===</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">compare</span>( <span style="color:#66d9ef">this</span>[ <span style="color:#ae81ff">0</span> ], <span style="color:#a6e22e">val</span> ) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span> ) {
               <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
           }
           <span style="color:#66d9ef">else</span> {
               <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">spos</span>;
           }
       };


       <span style="color:#75715e">/**
</span><span style="color:#75715e">       leftmost position of the given val
</span><span style="color:#75715e">      
</span><span style="color:#75715e">       @method firstPositionOf
</span><span style="color:#75715e">       @param {any} val
</span><span style="color:#75715e">       @return {Number} leftmost position of the value
</span><span style="color:#75715e">        */</span>

       <span style="color:#a6e22e">SortedList</span>.<span style="color:#a6e22e">prototype</span>.<span style="color:#a6e22e">firstPositionOf</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>( <span style="color:#a6e22e">val</span> ) {
           <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">index</span>, <span style="color:#a6e22e">num</span>, <span style="color:#a6e22e">ref</span>;
           <span style="color:#a6e22e">index</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">bsearch</span>( <span style="color:#a6e22e">val</span> );
           <span style="color:#66d9ef">if</span> ( <span style="color:#a6e22e">index</span> <span style="color:#f92672">===</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span> ) {
               <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
           }
           <span style="color:#a6e22e">num</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">val</span>[ <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">compareKey</span> ];
           <span style="color:#66d9ef">if</span> ( <span style="color:#a6e22e">num</span> <span style="color:#f92672">===</span> ( ( <span style="color:#a6e22e">ref</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>[ <span style="color:#a6e22e">index</span> ] ) <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">?</span> <span style="color:#a6e22e">ref</span>[ <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">compareKey</span> ] <span style="color:#f92672">:</span> <span style="color:#66d9ef">void</span> <span style="color:#ae81ff">0</span> ) ) {
               <span style="color:#66d9ef">while</span> ( <span style="color:#66d9ef">true</span> ) {
                   <span style="color:#66d9ef">if</span> ( <span style="color:#a6e22e">index</span> <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span> ) {
                       <span style="color:#66d9ef">break</span>;
                   }
                   <span style="color:#66d9ef">if</span> ( <span style="color:#66d9ef">this</span>[ <span style="color:#a6e22e">index</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span> ][ <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">compareKey</span> ] <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">num</span> ) {
                       <span style="color:#66d9ef">break</span>;
                   }
                   <span style="color:#a6e22e">index</span><span style="color:#f92672">--</span>;
               }
           }
           <span style="color:#66d9ef">else</span> {
               <span style="color:#a6e22e">index</span><span style="color:#f92672">++</span>;
           }
           <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">index</span>;
       };


       <span style="color:#75715e">/**
</span><span style="color:#75715e">       rightmost position of the given val
</span><span style="color:#75715e">      
</span><span style="color:#75715e">       @method lastPositionOf
</span><span style="color:#75715e">       @param {any} val
</span><span style="color:#75715e">       @return {Number} rightmost position of the value
</span><span style="color:#75715e">        */</span>

       <span style="color:#a6e22e">SortedList</span>.<span style="color:#a6e22e">prototype</span>.<span style="color:#a6e22e">lastPositionOf</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>( <span style="color:#a6e22e">val</span> ) {
           <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">index</span>, <span style="color:#a6e22e">num</span>;
           <span style="color:#a6e22e">index</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">bsearch</span>( <span style="color:#a6e22e">val</span> );
           <span style="color:#66d9ef">if</span> ( <span style="color:#a6e22e">index</span> <span style="color:#f92672">===</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span> ) {
               <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
           }
           <span style="color:#a6e22e">num</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">val</span>[ <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">compareKey</span> ];
           <span style="color:#66d9ef">if</span> ( <span style="color:#a6e22e">index</span> <span style="color:#f92672">===</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">num</span> <span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">max</span>() ) {
               <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">index</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>;
           }
           <span style="color:#66d9ef">while</span> ( <span style="color:#66d9ef">true</span> ) {
               <span style="color:#66d9ef">if</span> ( <span style="color:#a6e22e">index</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&gt;=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">length</span> ) {
                   <span style="color:#66d9ef">break</span>;
               }
               <span style="color:#66d9ef">if</span> ( <span style="color:#66d9ef">this</span>[ <span style="color:#a6e22e">index</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span> ][ <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">compareKey</span> ] <span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">num</span> ) {
                   <span style="color:#66d9ef">break</span>;
               }
               <span style="color:#a6e22e">index</span><span style="color:#f92672">++</span>;
           }
           <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">index</span>;
       };


       <span style="color:#75715e">/**
</span><span style="color:#75715e">        * sorted.toArray()
</span><span style="color:#75715e">        * get raw array
</span><span style="color:#75715e">        *
</span><span style="color:#75715e">        */</span>

       <span style="color:#a6e22e">SortedList</span>.<span style="color:#a6e22e">prototype</span>.<span style="color:#a6e22e">toArray</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>() {
           <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">slice</span>();
       };


       <span style="color:#75715e">/**
</span><span style="color:#75715e">       comparison function. Compares two objects by this.compareKey
</span><span style="color:#75715e">      
</span><span style="color:#75715e">       @method compare
</span><span style="color:#75715e">       @private
</span><span style="color:#75715e">       @param {any} a
</span><span style="color:#75715e">       @param {any} b
</span><span style="color:#75715e">        */</span>

       <span style="color:#a6e22e">SortedList</span>.<span style="color:#a6e22e">prototype</span>.<span style="color:#a6e22e">compare</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>( <span style="color:#a6e22e">a</span>, <span style="color:#a6e22e">b</span> ) {
           <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">c</span>;
           <span style="color:#66d9ef">if</span> ( <span style="color:#a6e22e">a</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span> ) {
               <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
           }
           <span style="color:#66d9ef">if</span> ( <span style="color:#a6e22e">b</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span> ) {
               <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
           }
           <span style="color:#a6e22e">c</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">a</span>[ <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">compareKey</span> ] <span style="color:#f92672">-</span> <span style="color:#a6e22e">b</span>[ <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">compareKey</span> ];
           <span style="color:#66d9ef">if</span> ( <span style="color:#a6e22e">c</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span> ) {
               <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
           }
           <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> ( <span style="color:#a6e22e">c</span> <span style="color:#f92672">===</span> <span style="color:#ae81ff">0</span> ) {
               <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
           }
           <span style="color:#66d9ef">else</span> {
               <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
           }
       };

       <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">SortedList</span>;

   } )( Array );

   <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">Point</span>;

   <span style="color:#a6e22e">Point</span> <span style="color:#f92672">=</span> ( <span style="color:#66d9ef">function</span>() {

       <span style="color:#75715e">/**
</span><span style="color:#75715e">       @constructor
</span><span style="color:#75715e">       @param {Number} val number
</span><span style="color:#75715e">       @param {Number|String} id id
</span><span style="color:#75715e">        */</span>
       <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">Point</span>( <span style="color:#a6e22e">val</span>, <span style="color:#a6e22e">id</span> ) {
           <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">val</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">val</span>;
           <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">id</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">id</span>;
       }

       <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">Point</span>;

   } )();
</code></pre></div>

<p>&nbsp;</p>
    </div>
    <div class="my-16 border-b border-gray-400"></div>
    <div class="mb-6 text-center max-w-3xl mx-auto">
        
        <a class="bg-transparent hover:bg-green-500 text-green-700 font-semibold hover:text-white py-2 px-4 border border-green-500 hover:border-transparent rounded block mb-4" href="https://javifm.com/beta/blog/reemplazando-atributos-html-con-sublime/">
            &laquo; Reemplazando atributos HTML con Sublime
        </a>
        
        
        <a class="bg-transparent hover:bg-green-500 text-green-700 font-semibold hover:text-white py-2 px-4 border border-green-500 hover:border-transparent rounded block mb-4" href="https://javifm.com/beta/blog/suscribirse-de-manera-segura-a-eventos-con-jquery/">
            Suscribirse de manera segura a eventos con jQuery &raquo;
        </a>
        
    </div>

</div>


      </main>
    
    
    
  </body>
</html>
