<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.58.3" />

<link rel="stylesheet" href="https://javifm.com/beta/css/styles.css">


<title>Detectar fin de una transición/animación CSS3 con Javascript | Frontend developer</title>

    
</head>

<body>
    <div id="site-wrapper" class="relative overflow-hidden w-full">
        <div id="site-canvas" class="w-full h-full relative">
            



<a id="skiplink" class="sr-only absolute top-0 left-0 mt-2 ml-1 font-semibold bg-gray-300 rounded-sm p-2 uppercase text-gray-700" href="#main">
    Saltar al contenido principal
</a>

<div class="bg-gray-100 prefers-dark:bg-gray-900 border-t-4 border-green-500">
    <div class="container mx-auto">
        <nav class="flex flex-wrap justify-end items-center py-6 px-4">
            
                
                
                
                
                
                    
                
                <a class="mr-6 first:-ml-2 p-2 uppercase text-gray-700 hidden sm:inline-flex hover:bg-gray-300 hover:rounded-sm" href="/beta/">Inicio</a>
            
                
                
                
                
                
                    
                
                <a class="mr-6 first:-ml-2 p-2 uppercase text-gray-700 hidden sm:inline-flex font-semibold bg-gray-300 rounded-sm" href="/beta/blog/">Blog</a>
            
                
                
                
                
                
                    
                
                <a class="mr-6 first:-ml-2 p-2 uppercase text-gray-700 hidden sm:inline-flex hover:bg-gray-300 hover:rounded-sm" href="/beta/tags/">Tags</a>
            
                
                
                
                
                
                    
                
                <a class="mr-6 first:-ml-2 p-2 uppercase text-gray-700 hidden sm:inline-flex hover:bg-gray-300 hover:rounded-sm" href="/beta/sobre-mi/">Sobre mí</a>
            
                
                
                
                
                
                    
                
                <a class="mr-6 first:-ml-2 p-2 uppercase text-gray-700 hidden sm:inline-flex hover:bg-gray-300 hover:rounded-sm" href="/beta/search/">Buscar</a>
            
            <button type="button" id="sidebar-open" aria-label="Abrir menu" class="sm:hidden text-gray-700 flex items-center uppercase text-xl p-1 -m-1">
                Menú
                



















<svg xmlns="http://www.w3.org/2000/svg" class='ml-2 w-6 h-6 fill-current'  id='open-menu' role="img" aria-labelledby="titleId" viewBox="0 0 20 20"><title id="titleId">Menú</title><path role="presentation" d="M0 3h20v2H0V3zm0 6h20v2H0V9zm0 6h20v2H0v-2z"></path></svg>


                



















<svg xmlns="http://www.w3.org/2000/svg" class='ml-2 w-6 h-6 fill-current hidden'  id='close-menu' role="img" aria-labelledby="titleId" viewBox="0 0 20 20"><title id="titleId">Cerrar</title><path role="presentation" d="M10 8.586L2.929 1.515 1.515 2.929 8.586 10l-7.071 7.071 1.414 1.414L10 11.414l7.071 7.071 1.414-1.414L11.414 10l7.071-7.071-1.414-1.414L10 8.586z"></path></svg>


            </button>
        </nav>
    </div>
</div>

<div id="site-menu" class="h-full absolute top-0 py-6 px-4 bg-gray-800 hidden">
    <nav class="flex flex-col uppercase text-xl">
    
        
        
        
        
        
            
        
        <a class="mb-1 px-4 py-2 text-gray-100" href="/beta/">Inicio</a>
    
        
        
        
        
        
            
        
        <a class="mb-1 px-4 py-2 bg-green-600 rounded text-white font-semibold outline-none focus:bg-white focus:text-green-600" href="/beta/blog/">Blog</a>
    
        
        
        
        
        
            
        
        <a class="mb-1 px-4 py-2 text-gray-100" href="/beta/tags/">Tags</a>
    
        
        
        
        
        
            
        
        <a class="mb-1 px-4 py-2 text-gray-100" href="/beta/sobre-mi/">Sobre mí</a>
    
        
        
        
        
        
            
        
        <a class="mb-1 px-4 py-2 text-gray-100" href="/beta/search/">Buscar</a>
    
    </nav>
</div>

            <main id="main">
                

<div class="container mx-auto px-4 single-post">
    <div class="my-6">
        <h1 class="title">Detectar fin de una transición/animación CSS3 con Javascript</h1>
        

<div class="flex flex-wrap flex-col sm:flex-row sm:items-center text-gray-700">
    <time datetime="2014-06-29">
        Publicado el 29 Jun 2014</time>
    
    <span>
        <span class="mx-2 hidden sm:inline-flex">&bull;</span>Tiempo de lectura: 2min
    </span>
    
</div>

    <div class="mt-4">
        
            
            <a class="tag inline-block text-sm mr-2 mb-2" href="https://javifm.com/beta/tags/css">css</a>
        
            
            <a class="tag inline-block text-sm mr-2 mb-2" href="https://javifm.com/beta/tags/javascript">javascript</a>
        
            
            <a class="tag inline-block text-sm mr-2 mb-2" href="https://javifm.com/beta/tags/jquery">jQuery</a>
        
    </div>


    </div>
    <div class="single-post-content">
        <p>Nunca me había visto en la necesidad de <strong>detectar cuando una transición CSS3 termina,</strong> pero el otro día en el trabajo, para desplegar cierta información, estamos utilizando 2 contenedores, y al añadir una clase se activa una animación CSS3 que va aumentando el margen izquierdo del div hasta que aparece el siguiente. Para ello estamos utilizando eventos de teclado, si pulsamos flecha derecha va hacia la derecha, en caso de pulsar la flecha izquierda, hacia la izquierda, muy sencillito.</p>

<p>¿Y qué pasa si pulsamos varias veces antes de que la animación termine? Pues que parece que va a tirones, y lo que es un efecto de transición muy elegante se convierte en un efecto muy desagradable. No estaba al tanto, pero cuando un elemento presenta una animación puramente en CSS3, en función del navegador, <strong>podemos suscribirnos a un evento que nos informará cuando la transición ha terminado.</strong> En este proyecto estamos utilizando jQuery, asi que la solución es bien sencilla:</p>

<p>Solución para transiciones:</p>

<div class="highlight"><pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="kd">var</span> <span class="nx">ended</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="nx">$</span><span class="p">(</span><span class="s2">&#34;#selector&#34;</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&#34;transitionend
</span><span class="s2">                     webkitTransitionEnd 
</span><span class="s2">                     oTransitionEnd 
</span><span class="s2">                     MSTransitionEnd&#34;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span> 
                        <span class="nx">ended</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                    <span class="p">});</span>
</code></pre></div>

<p>Solución para animaciones:</p>

<div class="highlight"><pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="kd">var</span> <span class="nx">ended</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="nx">$</span><span class="p">(</span><span class="s2">&#34;#someSelector&#34;</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&#34;animationend 
</span><span class="s2">                         webkitAnimationEnd 
</span><span class="s2">                         oAnimationEnd 
</span><span class="s2">                         MSAnimationEnd&#34;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
                        <span class="nx">ended</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                    <span class="p">});</span>
</code></pre></div>

<p>Si no deseas usar jQuery, en Modernizr tienen esto:</p>

<div class="highlight"><pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="kd">function</span> <span class="nx">transitionEndEventName</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span>
        <span class="kc">undefined</span><span class="p">,</span>
        <span class="nx">el</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">),</span>
        <span class="nx">transitions</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;transition&#39;</span><span class="o">:</span><span class="s1">&#39;transitionend&#39;</span><span class="p">,</span>
            <span class="s1">&#39;OTransition&#39;</span><span class="o">:</span><span class="s1">&#39;otransitionend&#39;</span><span class="p">,</span>  <span class="c1">// oTransitionEnd in very old Opera
</span><span class="c1"></span>            <span class="s1">&#39;MozTransition&#39;</span><span class="o">:</span><span class="s1">&#39;transitionend&#39;</span><span class="p">,</span>
            <span class="s1">&#39;WebkitTransition&#39;</span><span class="o">:</span><span class="s1">&#39;webkitTransitionEnd&#39;</span>
        <span class="p">};</span>

    <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="k">in</span> <span class="nx">transitions</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">transitions</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">el</span><span class="p">.</span><span class="nx">style</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">transitions</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">//TODO: throw &#39;TransitionEnd event is not supported in this browser&#39;; 
</span><span class="c1"></span><span class="p">}</span>
</code></pre></div>

<p>Y se utiliza de la siguiente manera:</p>

<div class="highlight"><pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="kd">var</span> <span class="nx">transitionEnd</span> <span class="o">=</span> <span class="nx">transitionEndEventName</span><span class="p">();</span>
<span class="nx">element</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="nx">transitionEnd</span><span class="p">,</span> <span class="nx">theFunctionToInvoke</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</code></pre></div>

<p>Encontré la solución en StackOverflow:</p>

<ul>
<li><a href="http://stackoverflow.com/questions/9255279/callback-when-css3-transition-finishes" title="Callback when CSS3 transition finishes">Callback when CSS3 transition finishes</a></li>
<li><a href="http://stackoverflow.com/questions/5023514/how-do-i-normalize-css3-transition-functions-across-browsers" title="How do I normalize CSS3 Transition functions across browsers?">How do I normalize CSS3 Transition functions across browsers?</a></li>
</ul>

    </div>
    <div class="my-16 border-b border-gray-400"></div>
    <div class="mb-6 text-center max-w-3xl mx-auto">
        
        <a class="outline-none bg-transparent text-green-700 font-semibold hover:text-white hover:bg-green-500 focus:text-white focus:bg-green-500 py-2 px-4 border border-green-500 hover:border-transparent rounded block mb-4" href="https://javifm.com/beta/blog/cambia-el-separador-de-palabras-en-sublime-text/">
            &laquo; Cambia el separador de palabras en Sublime Text
        </a>
        
        
        <a class="outline-none bg-transparent text-green-700 font-semibold hover:text-white hover:bg-green-500 focus:text-white focus:bg-green-500 py-2 px-4 border border-green-500 hover:border-transparent rounded block mb-4" href="https://javifm.com/beta/blog/depurar-remotamente-aplicaciones-html-con-weinre/">
            Depurar remotamente aplicaciones HTML con Weinre &raquo;
        </a>
        
    </div>

</div>


            </main>
            <footer class="bg-gray-900 text-blue-100 p-4">
    <div class="container">
        <div class="text-center">
            &copy; 2019 Sitio construido con Hugo alojado en Github.
        </div>
    </div>
</footer>

        </div>
    </div>
    
<script src="https://javifm.com/beta/js/focus-visible.min.js"></script>
<script>
    (function() {
        const $bodyElement = document.getElementsByTagName('body')[0];
        const $svgOpen = document.getElementById('open-menu');
        const $svgClose = document.getElementById('close-menu');
        const $siteCanvas = document.getElementById('site-canvas');
        const $siteMenu = document.getElementById('site-menu');
        const $buttonNav = document.getElementById('sidebar-open');
        const transitionEnd = transitionEndEventName();
        const CSS_CLASS_NAV = 'show-nav';
        let stateNav = 'closed';

        const closeMenuOnResize = debounce(function() {
            if ($bodyElement.classList.contains(CSS_CLASS_NAV) && window.screen.width > 639) {
                toggleNav();
            }
        }, 0);

        
        $buttonNav.addEventListener('click', toggleNav);
        window.addEventListener('resize', closeMenuOnResize);

        $siteCanvas.addEventListener(
            transitionEnd,
            function() {
                if (stateNav === 'opening') {
                    $svgOpen.classList.add('hidden');
                    $svgClose.classList.remove('hidden');
                    $buttonNav.setAttribute('aria-label', 'Cerrar menú');
                    stateNav = 'open';
                } else {
                    $svgOpen.classList.remove('hidden');
                    $svgClose.classList.add('hidden');
                    $siteMenu.classList.add('hidden');
                    $buttonNav.setAttribute('aria-label', 'Abrir menú');
                    stateNav = 'closed';
                }
            },
            false
        );
        
        

        function toggleNav() {
            if ($bodyElement.classList.contains(CSS_CLASS_NAV)) {
                $bodyElement.classList.remove(CSS_CLASS_NAV);
                stateNav = 'closing';
            } else {
                $bodyElement.classList.add(CSS_CLASS_NAV);
                stateNav = 'opening';
                $siteMenu.classList.remove('hidden');
            }
        }

        function debounce(func, wait, immediate) {
            let timeout;
            return function() {
                let context = this;
                let args = arguments;
                const later = function() {
                    timeout = null;
                    if (!immediate) {
                        func.apply(context, args);
                    }
                };
                let callNow = immediate && !timeout;
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
                if (callNow) {
                    func.apply(context, args);
                }
            };
        }

        function transitionEndEventName() {
            let i;
            const el = document.createElement('div');
            const transitions = {
                'transition': 'transitionend',
                'OTransition': 'otransitionend',  
                'MozTransition': 'transitionend',
                'WebkitTransition': 'webkitTransitionEnd'
            };

            for (i in transitions) {
                if (transitions.hasOwnProperty(i) && el.style[i] !== undefined) {
                    return transitions[i];
                }
            }
        }

    })();

</script>

    
</body>

</html>
