<!doctype html><html lang=es><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.128.1"><link rel=stylesheet href=https://javifm.com/css/styles.css><title>Arbol de intervalos (interval tree) en Javascript | Javier Fernández</title></head><body><div id=site-wrapper class="relative overflow-hidden w-full"><div id=site-canvas class="w-full h-full relative"><a id=skiplink class="sr-only absolute top-0 left-0 mt-2 ml-1 font-semibold bg-gray-200 text-gray-700 dark:bg-gray-700 dark:text-gray-300 rounded-sm p-2 uppercase" href=#main>Saltar al contenido principal</a><div class="bg-gray-50 dark:bg-gray-800 border-t-4 border-green-500"><div class="max-w-7xl mx-auto"><nav class="flex flex-wrap items-center p-4"><a href=https://javifm.com/ class="mr-auto p-2 -m-2 last:mr-0" aria-hidden=true><span class=sr-only>Inicio</span>
<svg version="1.0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 3640 3640" aria-hidden="true" class="w-10 h-10"><path d="M2958 1348l-156-202 69-55c89-70 141-147 147-217 11-127-66-244-181-278-67-19-79-20-139-2-66 21-67 21-228 151-505 408-832 666-840 663-11-4-310-378-310-388 0-9 943-765 1025-822 119-84 245-120 415-121 156 0 305 41 418 116 145 96 269 258 320 417 19 60 39 203 36 255-8 119-39 244-82 327-19 36-96 145-129 183-10 11-54 49-98 84-44 36-87 70-96 78-14 12-35-11-171-189z" id="layer101" fill="#0080b2" stroke="none"/><path d="M671 1839c-227-280-432-541-455-579-115-186-141-441-67-658C264 269 6e2 48 955 73c112 8 193 30 3e2 82 116 56 190 117 293 240 66 80 80 102 70 112-7 7-101 80-208 163l-195 151-40-48c-22-26-61-69-86-94-136-136-365-86-434 94-22 59-17 148 12 204 12 23 205 267 428 543 224 276 405 503 403 504s-91 71-198 156c-107 84-2e2 157-206 161-6 5-163-181-423-502z" id="layer102" fill="#03b8ab" stroke="none"/><path d="M741 3559c-118-23-249-84-345-162-327-262-385-737-132-1074 43-57 94-105 207-196l46-37 153 196c84 108 153 202 154 209 0 7-30 39-69 71-90 76-125 140-125 230 0 187 197 311 365 230 28-14 270-2e2 540-415 269-215 493-390 497-389 4 2 78 90 164 197 109 135 154 198 148 207-15 22-965 774-1034 819-84 55-166 89-262 109-82 17-234 20-307 5z" id="layer103" fill="#ea6675" stroke="none"/><path d="M2605 3556c-191-44-333-137-477-314-51-62-58-76-47-87 8-7 99-79 203-160l189-147 26 34c99 127 165 170 264 171 113 0 207-68 243-176 18-55 15-131-8-182-7-16-192-254-411-529-327-409-396-501-385-511 49-45 373-298 383-299 13-1 750 913 823 1020 84 124 125 262 125 424 0 339-204 620-530 733-75 25-105 30-213 33-83 3-145-1-185-10z" id="layer104" fill="#ffa73d" stroke="none"/></svg>
</a><a class="p-2 uppercase text-gray-700 hidden sm:inline-flex hover:bg-gray-200 dark:hover:bg-transparent hover:rounded-sm dark:text-gray-200 dark:hover:text-green-400 mr-3 md:mr-6" href=https://javifm.com/>Inicio</a>
<a class="p-2 uppercase text-gray-700 hidden sm:inline-flex font-semibold bg-gray-200 dark:bg-transparent rounded-sm dark:text-green-400 mr-3 md:mr-6" href=https://javifm.com/blog/ aria-current=page>Blog</a>
<a class="p-2 uppercase text-gray-700 hidden sm:inline-flex hover:bg-gray-200 dark:hover:bg-transparent hover:rounded-sm dark:text-gray-200 dark:hover:text-green-400 mr-3 md:mr-6" href=https://javifm.com/about/>Sobre mí</a>
<a class="p-2 uppercase text-gray-700 hidden sm:inline-flex hover:bg-gray-200 dark:hover:bg-transparent hover:rounded-sm dark:text-gray-200 dark:hover:text-green-400 mr-3 md:mr-6" href=https://javifm.com/search/>Buscar</a>
<a class="p-2 uppercase text-gray-700 hidden sm:inline-flex hover:bg-gray-200 dark:hover:bg-transparent hover:rounded-sm dark:text-gray-200 dark:hover:text-green-400 mr-3 md:mr-6" href=https://javifm.com/contact/>Contacto</a>
<span class="hidden sm:inline"><div><label id=listbox-label class=sr-only>Language</label><div class="mt-1 relative" id=desktopContainerLanguageSelector><button type=button id=desktopButtonLanguageSelector class="relative w-full bg-white border border-gray-300 rounded-md shadow-sm pl-3 pr-10 py-2 text-left cursor-default focus:outline-none focus:ring-1 focus:ring-green-500 focus:border-green-500 sm:text-sm" aria-haspopup=listbox aria-expanded=true aria-labelledby=listbox-label>
<span class="flex items-center"><span>🇪🇸</span>
<span class="ml-3 block truncate">ES</span>
</span><span class="ml-3 absolute inset-y-0 right-0 flex items-center pr-2 pointer-events-none"><svg class="h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M10 3a1 1 0 01.707.293l3 3a1 1 0 01-1.414 1.414L10 5.414 7.707 7.707A1 1 0 016.293 6.293l3-3A1 1 0 0110 3zm-3.707 9.293a1 1 0 011.414.0L10 14.586l2.293-2.293a1 1 0 011.414 1.414l-3 3a1 1 0 01-1.414.0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"/></svg></span></button><ul id=desktopLanguageList class="absolute z-10 mt-1 w-full bg-white shadow-lg max-h-56 rounded-md py-1 text-base ring-1 ring-black ring-opacity-5 overflow-auto focus:outline-none sm:text-sm hidden" tabindex=-1 role=listbox aria-labelledby=listbox-label aria-activedescendant=listbox-option-ES><li class="text-gray-900 hover:bg-gray-100 cursor-pointer select-none relative py-2 pl-3 pr-9" id=listbox-option-ES tabindex=-1 role=option data-url=https://javifm.com/><div class="flex items-center"><span>🇪🇸</span>
<span class="font-semibold ml-3 block truncate">ES</span></div><span class="text-green-600 absolute inset-y-0 right-0 flex items-center pr-4"><svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414.0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414.0z" clip-rule="evenodd"/></svg></span></li><li class="text-gray-900 hover:bg-gray-100 cursor-pointer select-none relative py-2 pl-3 pr-9" id=listbox-option-EN tabindex=-1 role=option data-url=https://javifm.com/en/><div class="flex items-center"><span>🇬🇧</span>
<span class="font-normal ml-3 block truncate">EN</span></div></li></ul></div></div></span><button type=button id=sidebar-open aria-label="Abrir menu" class="sm:hidden text-gray-700 dark:text-gray-300 flex items-center uppercase text-xl p-1 -m-1">
Menú<svg xmlns="http://www.w3.org/2000/svg" class="ml-2 w-6 h-6 fill-current" id="open-menu" role="img" aria-labelledby="titleId" viewBox="0 0 20 20"><title id="titleId">Menú</title><path role="presentation" d="M0 3h20v2H0V3zm0 6h20v2H0V9zm0 6h20v2H0v-2z"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="ml-2 w-6 h-6 fill-current hidden" id="close-menu" role="img" aria-labelledby="titleId" viewBox="0 0 20 20"><title id="titleId">Cerrar</title><path role="presentation" d="M10 8.586 2.929 1.515 1.515 2.929 8.586 10l-7.071 7.071 1.414 1.414L10 11.414l7.071 7.071 1.414-1.414L11.414 10l7.071-7.071-1.414-1.414L10 8.586z"/></svg></button></nav></div></div><div id=site-menu class="h-full absolute top-0 py-6 px-4 bg-gray-800 dark:bg-gray-800 hidden border-l border-transparent dark:border-gray-700"><nav class="flex flex-col uppercase text-xl"><span class="inline sm:hidden mb-4"><div><label id=listbox-label class=sr-only>Language</label><div class="mt-1 relative" id=mobileContainerLanguageSelector><button type=button id=mobileButtonLanguageSelector class="relative w-full bg-white border border-gray-300 rounded-md shadow-sm pl-3 pr-10 py-2 text-left cursor-default focus:outline-none focus:ring-1 focus:ring-green-500 focus:border-green-500 sm:text-sm" aria-haspopup=listbox aria-expanded=true aria-labelledby=listbox-label>
<span class="flex items-center"><span>🇪🇸</span>
<span class="ml-3 block truncate">ES</span>
</span><span class="ml-3 absolute inset-y-0 right-0 flex items-center pr-2 pointer-events-none"><svg class="h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M10 3a1 1 0 01.707.293l3 3a1 1 0 01-1.414 1.414L10 5.414 7.707 7.707A1 1 0 016.293 6.293l3-3A1 1 0 0110 3zm-3.707 9.293a1 1 0 011.414.0L10 14.586l2.293-2.293a1 1 0 011.414 1.414l-3 3a1 1 0 01-1.414.0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"/></svg></span></button><ul id=mobileLanguageList class="absolute z-10 mt-1 w-full bg-white shadow-lg max-h-56 rounded-md py-1 text-base ring-1 ring-black ring-opacity-5 overflow-auto focus:outline-none sm:text-sm hidden" tabindex=-1 role=listbox aria-labelledby=listbox-label aria-activedescendant=listbox-option-ES><li class="text-gray-900 hover:bg-gray-100 cursor-pointer select-none relative py-2 pl-3 pr-9" id=listbox-option-ES tabindex=-1 role=option data-url=https://javifm.com/><div class="flex items-center"><span>🇪🇸</span>
<span class="font-semibold ml-3 block truncate">ES</span></div><span class="text-green-600 absolute inset-y-0 right-0 flex items-center pr-4"><svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414.0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414.0z" clip-rule="evenodd"/></svg></span></li><li class="text-gray-900 hover:bg-gray-100 cursor-pointer select-none relative py-2 pl-3 pr-9" id=listbox-option-EN tabindex=-1 role=option data-url=https://javifm.com/en/><div class="flex items-center"><span>🇬🇧</span>
<span class="font-normal ml-3 block truncate">EN</span></div></li></ul></div></div></span><a class="mb-1 px-4 py-2 text-gray-100" href=https://javifm.com/>Inicio</a>
<a class="mb-1 px-4 py-2 bg-green-600 rounded text-white font-semibold outline-none focus:bg-white focus:text-green-600" href=https://javifm.com/blog/>Blog</a>
<a class="mb-1 px-4 py-2 text-gray-100" href=https://javifm.com/about/>Sobre mí</a>
<a class="mb-1 px-4 py-2 text-gray-100" href=https://javifm.com/search/>Buscar</a>
<a class="mb-1 px-4 py-2 text-gray-100" href=https://javifm.com/contact/>Contacto</a></nav></div><main id=main><div class="bg-gray-100 dark:bg-gray-800 border-b border-gray-300 dark:border-gray-600"></div><article class="max-w-7xl mx-auto px-4 single-post"><div class=my-6><h1 class=title>Arbol de intervalos (interval tree) en Javascript</h1><div class="flex flex-wrap flex-col sm:flex-row sm:items-center text-gray-600 dark:text-gray-300"><time datetime=2016-09-09>Publicado el 9 Sep 2016
</time><span><span class="mx-2 hidden sm:inline-flex">&bull;</span>Tiempo de lectura: 13 min</span></div><div class=mt-4><a class="tag inline-block text-sm mr-2 mb-2" href=https://javifm.com/tags/algoritmos>algoritmos</a>
<a class="tag inline-block text-sm mr-2 mb-2" href=https://javifm.com/tags/javascript>javascript</a></div></div><div class=single-post-content><p>Continúo aprendiendo cosas en mi proyecto laboral actual. En este caso, para <strong>optimizar el rendimiento de una búsqueda en un objeto enorme en Javascript.</strong> El problema es el siguiente, se han de encontrar los nodos que pertenecen a un intervalo dado. En este caso en concreto, se dispone de una lista de canales de televisión, para los cuales disponemos de todos los programas, relativos a varios días de programación.</p><p>En los navegadores de hoy en día, como Google Chrome o cualquier navegador medianamente moderno, <strong>no habría excesivos problemas en iterar por fuerza bruta</strong> hasta encontrar todos los eventos cuya fecha de inicio y fin se encontrase dentro del intervalo (ojo, para nada digo que sea lo más óptimo ni recomendado). Los problemas pueden llegar cuando en el target del proyecto podemos encontrar televisiones Smart TV´s antiguas y/o de gama baja, que vienen <strong>más justas de memoria.</strong></p><p>Además, no es un escenario normal, en mi caso los datos se encuentran en formato binario, y es necesario realizar una descodificación antes de saber si un determinado programa de un canal está dentro del rango horario buscado o no. Para ello podemos elaborar un <a href=https://es.wikipedia.org/wiki/%C3%81rbol_de_intervalo>árbol de intervalos,</a> algo bastante sencillo de hacer en lenguajes como Java, pero más difícil en Javascript. Por suerte, siempre <strong>podemos encontrar librerías y código de terceros</strong> que ya haya resuelto este y otros algoritmos para Javascript, en este caso yo he utilizado ésta librería, <a href=https://github.com/shinout/interval-tree2>interval-tree2.</a></p><p>Su uso es muy sencillo, tal y como describen en su sitio de Github. En nuestro proyecto utilizamos <strong>RequireJS</strong> como cargador de módulos, asi que adapté los distintos ficheros y los convertí en módulos. Si no tienes ni idea de <a href=http://coffeescript.org/>CoffeeScript</a> (lenguaje que compila a Javascript), ni de como compilarlo, puedes instalarte el paquete por npm, que es lo que hice yo y de ahí cogí los ficheros js.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>npm install interval-tree2
</span></span></code></pre></div><p>En la carpeta <em>dist</em> se encuentran los ficheros necesarios:</p><ul><li>interval.js</li><li>interval-tree.js</li><li>node.js</li><li>point.js</li><li>sorted-list.js</li><li>util.js</li></ul><p>Yo he cogido todos, los he modificado para usarlos en entorno web, pongo el código al final de la entrada. Siguiendo el ejemplo puesto por el autor. Para crear un árbol y añadir intervalos:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>var</span> <span class=nx>itree</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>IntervalTree</span><span class=p>(</span><span class=mi>300</span><span class=p>);</span> <span class=c1>// 300 : Centro del árbol
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// &#39;foo&#39; es el identificador del intervalo
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>itree</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=mi>22</span><span class=p>,</span> <span class=mi>56</span><span class=p>,</span> <span class=s1>&#39;foo&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// &#39;bar&#39; es el identificador del intervalo
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>itree</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=mi>44</span><span class=p>,</span> <span class=mi>199</span><span class=p>,</span> <span class=s1>&#39;bar&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Si no se pone id, se asigna automáticamente uno
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>itree</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>38</span><span class=p>);</span>
</span></span></code></pre></div><p>Una vez insertados los intervalos, a la hora de buscar disponemos de 2 métodos:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// Intervalos que coinciden con un punto
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>var</span> <span class=nx>intervals</span> <span class=o>=</span> <span class=nx>itree</span><span class=p>.</span><span class=nx>pointSearch</span><span class=p>(</span><span class=mi>103</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Intervalos que entran en el rango solicitado
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>var</span> <span class=nx>intervals2</span> <span class=o>=</span> <span class=nx>itree</span><span class=p>.</span><span class=nx>rangeSearch</span><span class=p>(</span><span class=mi>103</span><span class=p>,</span> <span class=mi>400</span><span class=p>);</span>
</span></span></code></pre></div><p>Una vez obtenidos, se pueden recorrer todos los intervalos:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>intervals2</span><span class=p>.</span><span class=nx>forEach</span><span class=p>(</span><span class=kd>function</span><span class=p>(</span><span class=nx>interval</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>interval</span><span class=p>.</span><span class=nx>start</span><span class=p>);</span> <span class=c1>// Posición de inicio
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>interval</span><span class=p>.</span><span class=nx>end</span><span class=p>);</span> <span class=c1>// Posición de fin
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>interval</span><span class=p>.</span><span class=nx>id</span><span class=p>);</span> <span class=c1>// ID
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>});</span>
</span></span></code></pre></div><p>Por último, se puede eliminar un intervalo dado su id:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>itree</span><span class=p>.</span><span class=nx>remove</span><span class=p>(</span><span class=s1>&#39;foo&#39;</span><span class=p>);</span>
</span></span></code></pre></div><p>En mi caso, encontré especialmente útil el id de cada intervalo, pues lo usaba para obtener información de la posición dentro del binario donde poder buscar la información de cada programa. Cada canal de televisión dispone de su árbol, y cada evento tenía un id de este estilo:</p><p>dia_deprogramacion|posicion_binario</p><p>Ejemplo: “5|250”</p><p>Aquí está todo el código de seguido, en formato módulos de Javascript, listo para importar y comenzar a usarse en entorno web.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>var</span> <span class=nx>Node</span> <span class=o>=</span> <span class=p>(</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>       @constructor
</span></span></span><span class=line><span class=cl><span class=cm>       @param {Number} center center of the node
</span></span></span><span class=line><span class=cl><span class=cm>        */</span>
</span></span><span class=line><span class=cl>       <span class=kd>function</span> <span class=nx>Node</span><span class=p>(</span> <span class=nx>center</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>           <span class=k>this</span><span class=p>.</span><span class=nx>center</span> <span class=o>=</span> <span class=nx>center</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>           <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>           another node whose center is less than this.center
</span></span></span><span class=line><span class=cl><span class=cm>    
</span></span></span><span class=line><span class=cl><span class=cm>           @property {Node} left
</span></span></span><span class=line><span class=cl><span class=cm>            */</span>
</span></span><span class=line><span class=cl>           <span class=k>this</span><span class=p>.</span><span class=nx>left</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>           <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>           another node whose center is greater than this.center
</span></span></span><span class=line><span class=cl><span class=cm>    
</span></span></span><span class=line><span class=cl><span class=cm>           @property {Node} right
</span></span></span><span class=line><span class=cl><span class=cm>            */</span>
</span></span><span class=line><span class=cl>           <span class=k>this</span><span class=p>.</span><span class=nx>right</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>           <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>           sorted list of Intervals, sorting them by their start property
</span></span></span><span class=line><span class=cl><span class=cm>    
</span></span></span><span class=line><span class=cl><span class=cm>           @property {SortedList(Interval)} starts
</span></span></span><span class=line><span class=cl><span class=cm>            */</span>
</span></span><span class=line><span class=cl>           <span class=k>this</span><span class=p>.</span><span class=nx>starts</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>SortedList</span><span class=p>(</span> <span class=s1>&#39;start&#39;</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>           <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>           sorted list of Intervals, sorting them by their end property
</span></span></span><span class=line><span class=cl><span class=cm>    
</span></span></span><span class=line><span class=cl><span class=cm>           @property {SortedList(Interval)} ends
</span></span></span><span class=line><span class=cl><span class=cm>            */</span>
</span></span><span class=line><span class=cl>           <span class=k>this</span><span class=p>.</span><span class=nx>ends</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>SortedList</span><span class=p>(</span> <span class=s1>&#39;end&#39;</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>       <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>       the number of intervals
</span></span></span><span class=line><span class=cl><span class=cm>  
</span></span></span><span class=line><span class=cl><span class=cm>       @method count
</span></span></span><span class=line><span class=cl><span class=cm>       @return {Number}
</span></span></span><span class=line><span class=cl><span class=cm>        */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=nx>Node</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>count</span> <span class=o>=</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>           <span class=k>return</span> <span class=k>this</span><span class=p>.</span><span class=nx>starts</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span>
</span></span><span class=line><span class=cl>       <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>       insert an interval
</span></span></span><span class=line><span class=cl><span class=cm>  
</span></span></span><span class=line><span class=cl><span class=cm>       @method insert
</span></span></span><span class=line><span class=cl><span class=cm>       @param {Interval} interval
</span></span></span><span class=line><span class=cl><span class=cm>        */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=nx>Node</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>insert</span> <span class=o>=</span> <span class=kd>function</span><span class=p>(</span> <span class=nx>interval</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>           <span class=k>this</span><span class=p>.</span><span class=nx>starts</span><span class=p>.</span><span class=nx>insert</span><span class=p>(</span> <span class=nx>interval</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>           <span class=k>return</span> <span class=k>this</span><span class=p>.</span><span class=nx>ends</span><span class=p>.</span><span class=nx>insert</span><span class=p>(</span> <span class=nx>interval</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>       <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>       get intervals whose start position is less than or equal to the given value
</span></span></span><span class=line><span class=cl><span class=cm>  
</span></span></span><span class=line><span class=cl><span class=cm>       @method startPointSearch
</span></span></span><span class=line><span class=cl><span class=cm>       @param {Number} val
</span></span></span><span class=line><span class=cl><span class=cm>       @return {Array(Interval)}
</span></span></span><span class=line><span class=cl><span class=cm>        */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=nx>Node</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>startPointSearch</span> <span class=o>=</span> <span class=kd>function</span><span class=p>(</span> <span class=nx>val</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>           <span class=kd>var</span> <span class=nx>index</span><span class=p>;</span>
</span></span><span class=line><span class=cl>           <span class=nx>index</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>starts</span><span class=p>.</span><span class=nx>lastPositionOf</span><span class=p>(</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>               <span class=nx>start</span><span class=o>:</span> <span class=nx>val</span>
</span></span><span class=line><span class=cl>           <span class=p>}</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>           <span class=k>return</span> <span class=k>this</span><span class=p>.</span><span class=nx>starts</span><span class=p>.</span><span class=nx>slice</span><span class=p>(</span> <span class=mi>0</span><span class=p>,</span> <span class=nx>index</span> <span class=o>+</span> <span class=mi>1</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>       <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>       get intervals whose end position is more than or equal to the given value
</span></span></span><span class=line><span class=cl><span class=cm>  
</span></span></span><span class=line><span class=cl><span class=cm>       @method endPointSearch
</span></span></span><span class=line><span class=cl><span class=cm>       @param {Number} val
</span></span></span><span class=line><span class=cl><span class=cm>       @return {Array(Interval)}
</span></span></span><span class=line><span class=cl><span class=cm>        */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=nx>Node</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>endPointSearch</span> <span class=o>=</span> <span class=kd>function</span><span class=p>(</span> <span class=nx>val</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>           <span class=kd>var</span> <span class=nx>index</span><span class=p>;</span>
</span></span><span class=line><span class=cl>           <span class=nx>index</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>ends</span><span class=p>.</span><span class=nx>firstPositionOf</span><span class=p>(</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>               <span class=nx>end</span><span class=o>:</span> <span class=nx>val</span>
</span></span><span class=line><span class=cl>           <span class=p>}</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>           <span class=k>return</span> <span class=k>this</span><span class=p>.</span><span class=nx>ends</span><span class=p>.</span><span class=nx>slice</span><span class=p>(</span> <span class=nx>index</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>       <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>       gets all registered interval
</span></span></span><span class=line><span class=cl><span class=cm>  
</span></span></span><span class=line><span class=cl><span class=cm>       @method getAllIntervals
</span></span></span><span class=line><span class=cl><span class=cm>       @return {Array(Interval)}
</span></span></span><span class=line><span class=cl><span class=cm>        */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=nx>Node</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>getAllIntervals</span> <span class=o>=</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>           <span class=k>return</span> <span class=k>this</span><span class=p>.</span><span class=nx>starts</span><span class=p>.</span><span class=nx>toArray</span><span class=p>();</span>
</span></span><span class=line><span class=cl>       <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>       remove the given interval
</span></span></span><span class=line><span class=cl><span class=cm>  
</span></span></span><span class=line><span class=cl><span class=cm>       @method remove
</span></span></span><span class=line><span class=cl><span class=cm>       @param {Interval} interval
</span></span></span><span class=line><span class=cl><span class=cm>       @param {SortedList} list
</span></span></span><span class=line><span class=cl><span class=cm>        */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=nx>Node</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>remove</span> <span class=o>=</span> <span class=kd>function</span><span class=p>(</span> <span class=nx>interval</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>           <span class=k>this</span><span class=p>.</span><span class=nx>removeFromList</span><span class=p>(</span> <span class=nx>interval</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=nx>starts</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>           <span class=k>return</span> <span class=k>this</span><span class=p>.</span><span class=nx>removeFromList</span><span class=p>(</span> <span class=nx>interval</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=nx>ends</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>       <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>       remove the given interval from the given list
</span></span></span><span class=line><span class=cl><span class=cm>  
</span></span></span><span class=line><span class=cl><span class=cm>       @method removeFromList
</span></span></span><span class=line><span class=cl><span class=cm>       @private
</span></span></span><span class=line><span class=cl><span class=cm>       @param {Interval} interval
</span></span></span><span class=line><span class=cl><span class=cm>       @param {SortedList} list
</span></span></span><span class=line><span class=cl><span class=cm>        */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=nx>Node</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>removeFromList</span> <span class=o>=</span> <span class=kd>function</span><span class=p>(</span> <span class=nx>interval</span><span class=p>,</span> <span class=nx>list</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>           <span class=kd>var</span> <span class=nx>candidate</span><span class=p>,</span> <span class=nx>firstPos</span><span class=p>,</span> <span class=nx>i</span><span class=p>,</span> <span class=nx>idx</span><span class=p>,</span> <span class=nx>ref</span><span class=p>,</span> <span class=nx>ref1</span><span class=p>,</span> <span class=nx>results</span><span class=p>;</span>
</span></span><span class=line><span class=cl>           <span class=nx>firstPos</span> <span class=o>=</span> <span class=nx>list</span><span class=p>.</span><span class=nx>firstPositionOf</span><span class=p>(</span> <span class=nx>interval</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>           <span class=nx>results</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>           <span class=k>for</span> <span class=p>(</span> <span class=nx>idx</span> <span class=o>=</span> <span class=nx>i</span> <span class=o>=</span> <span class=nx>ref</span> <span class=o>=</span> <span class=nx>firstPos</span><span class=p>,</span> <span class=nx>ref1</span> <span class=o>=</span> <span class=nx>list</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span> <span class=nx>ref</span> <span class=o>&lt;=</span> <span class=nx>ref1</span> <span class=o>?</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=nx>ref1</span> <span class=o>:</span> <span class=nx>i</span> <span class=o>&gt;</span> <span class=nx>ref1</span><span class=p>;</span> <span class=nx>idx</span> <span class=o>=</span> <span class=nx>ref</span> <span class=o>&lt;=</span> <span class=nx>ref1</span> <span class=o>?</span> <span class=o>++</span><span class=nx>i</span> <span class=o>:</span> <span class=o>--</span><span class=nx>i</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>               <span class=nx>candidate</span> <span class=o>=</span> <span class=nx>list</span><span class=p>[</span> <span class=nx>idx</span> <span class=p>];</span>
</span></span><span class=line><span class=cl>               <span class=k>if</span> <span class=p>(</span> <span class=nx>candidate</span><span class=p>.</span><span class=nx>id</span> <span class=o>===</span> <span class=nx>interval</span><span class=p>.</span><span class=nx>id</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                   <span class=nx>list</span><span class=p>.</span><span class=nx>remove</span><span class=p>(</span> <span class=nx>idx</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>                   <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>               <span class=p>}</span>
</span></span><span class=line><span class=cl>               <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                   <span class=nx>results</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span> <span class=k>void</span> <span class=mi>0</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>               <span class=p>}</span>
</span></span><span class=line><span class=cl>           <span class=p>}</span>
</span></span><span class=line><span class=cl>           <span class=k>return</span> <span class=nx>results</span><span class=p>;</span>
</span></span><span class=line><span class=cl>       <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=k>return</span> <span class=nx>Node</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   <span class=p>}</span> <span class=p>)();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   <span class=kd>var</span> <span class=nx>Interval</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   <span class=nx>Interval</span> <span class=o>=</span> <span class=p>(</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>       @constructor
</span></span></span><span class=line><span class=cl><span class=cm>       @param {Number} start start of the interval
</span></span></span><span class=line><span class=cl><span class=cm>       @param {Number} end end of the interval
</span></span></span><span class=line><span class=cl><span class=cm>       @param {Number|String} id id of the interval
</span></span></span><span class=line><span class=cl><span class=cm>        */</span>
</span></span><span class=line><span class=cl>       <span class=kd>function</span> <span class=nx>Interval</span><span class=p>(</span> <span class=nx>start</span><span class=p>,</span> <span class=nx>end</span><span class=p>,</span> <span class=nx>id</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>           <span class=k>this</span><span class=p>.</span><span class=nx>start</span> <span class=o>=</span> <span class=nx>start</span><span class=p>;</span>
</span></span><span class=line><span class=cl>           <span class=k>this</span><span class=p>.</span><span class=nx>end</span> <span class=o>=</span> <span class=nx>end</span><span class=p>;</span>
</span></span><span class=line><span class=cl>           <span class=k>this</span><span class=p>.</span><span class=nx>id</span> <span class=o>=</span> <span class=nx>id</span><span class=p>;</span>
</span></span><span class=line><span class=cl>       <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>       get center of the interval
</span></span></span><span class=line><span class=cl><span class=cm>      
</span></span></span><span class=line><span class=cl><span class=cm>       @method center
</span></span></span><span class=line><span class=cl><span class=cm>       @return {Number} center
</span></span></span><span class=line><span class=cl><span class=cm>        */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=nx>Interval</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>center</span> <span class=o>=</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>           <span class=k>return</span> <span class=p>(</span> <span class=k>this</span><span class=p>.</span><span class=nx>start</span> <span class=o>+</span> <span class=k>this</span><span class=p>.</span><span class=nx>end</span> <span class=p>)</span> <span class=o>/</span> <span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>       <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=k>return</span> <span class=nx>Interval</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   <span class=p>}</span> <span class=p>)();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   <span class=kd>var</span> <span class=nx>IntervalTree</span> <span class=o>=</span> <span class=p>(</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>       @constructor
</span></span></span><span class=line><span class=cl><span class=cm>       @param {Number} center center of the root node
</span></span></span><span class=line><span class=cl><span class=cm>        */</span>
</span></span><span class=line><span class=cl>       <span class=kd>function</span> <span class=nx>IntervalTree</span><span class=p>(</span> <span class=nx>center</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>           <span class=nx>Util</span><span class=p>.</span><span class=nx>assertNumber</span><span class=p>(</span> <span class=nx>center</span><span class=p>,</span> <span class=s1>&#39;IntervalTree: center&#39;</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>           <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>           center =&gt; node
</span></span></span><span class=line><span class=cl><span class=cm>    
</span></span></span><span class=line><span class=cl><span class=cm>           @property {Object(Node)} nodesByCenter
</span></span></span><span class=line><span class=cl><span class=cm>            */</span>
</span></span><span class=line><span class=cl>           <span class=k>this</span><span class=p>.</span><span class=nx>nodesByCenter</span> <span class=o>=</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>           <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>           root node
</span></span></span><span class=line><span class=cl><span class=cm>    
</span></span></span><span class=line><span class=cl><span class=cm>           @property {Node} root
</span></span></span><span class=line><span class=cl><span class=cm>            */</span>
</span></span><span class=line><span class=cl>           <span class=k>this</span><span class=p>.</span><span class=nx>root</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>createNode</span><span class=p>(</span> <span class=nx>center</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>           <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>           interval id =&gt; interval
</span></span></span><span class=line><span class=cl><span class=cm>    
</span></span></span><span class=line><span class=cl><span class=cm>           @property {Object(Interval)} intervalsById
</span></span></span><span class=line><span class=cl><span class=cm>            */</span>
</span></span><span class=line><span class=cl>           <span class=k>this</span><span class=p>.</span><span class=nx>intervalsById</span> <span class=o>=</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>           <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>           interval id =&gt; node
</span></span></span><span class=line><span class=cl><span class=cm>    
</span></span></span><span class=line><span class=cl><span class=cm>           @property {Object(Node)} nodesById
</span></span></span><span class=line><span class=cl><span class=cm>            */</span>
</span></span><span class=line><span class=cl>           <span class=k>this</span><span class=p>.</span><span class=nx>nodesById</span> <span class=o>=</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>           <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>           sorted list of whole point
</span></span></span><span class=line><span class=cl><span class=cm>    
</span></span></span><span class=line><span class=cl><span class=cm>           @property {SortedList(Point)} pointTree
</span></span></span><span class=line><span class=cl><span class=cm>            */</span>
</span></span><span class=line><span class=cl>           <span class=k>this</span><span class=p>.</span><span class=nx>pointTree</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>SortedList</span><span class=p>(</span> <span class=s1>&#39;val&#39;</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>           <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>           unique id candidate of interval without id to be added next time
</span></span></span><span class=line><span class=cl><span class=cm>    
</span></span></span><span class=line><span class=cl><span class=cm>           @property {Number} idCandidate
</span></span></span><span class=line><span class=cl><span class=cm>            */</span>
</span></span><span class=line><span class=cl>           <span class=k>this</span><span class=p>.</span><span class=nx>idCandidate</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>       <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>       add one interval
</span></span></span><span class=line><span class=cl><span class=cm>  
</span></span></span><span class=line><span class=cl><span class=cm>       @method add
</span></span></span><span class=line><span class=cl><span class=cm>       @public
</span></span></span><span class=line><span class=cl><span class=cm>       @param {Number} start start of the interval to create
</span></span></span><span class=line><span class=cl><span class=cm>       @param {Number} end   end of the interval to create
</span></span></span><span class=line><span class=cl><span class=cm>       @param {String|Number} [id] identifier to distinguish intervals. Automatically defined when not set.
</span></span></span><span class=line><span class=cl><span class=cm>       @return {Interval}
</span></span></span><span class=line><span class=cl><span class=cm>        */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=nx>IntervalTree</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>add</span> <span class=o>=</span> <span class=kd>function</span><span class=p>(</span> <span class=nx>start</span><span class=p>,</span> <span class=nx>end</span><span class=p>,</span> <span class=nx>id</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>           <span class=kd>var</span> <span class=nx>interval</span><span class=p>;</span>
</span></span><span class=line><span class=cl>           <span class=k>if</span> <span class=p>(</span> <span class=k>this</span><span class=p>.</span><span class=nx>intervalsById</span><span class=p>[</span> <span class=nx>id</span> <span class=p>]</span> <span class=o>!=</span> <span class=kc>null</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>               <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span> <span class=s1>&#39;id &#39;</span> <span class=o>+</span> <span class=nx>id</span> <span class=o>+</span> <span class=s1>&#39; is already registered.&#39;</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>           <span class=p>}</span>
</span></span><span class=line><span class=cl>           <span class=k>if</span> <span class=p>(</span> <span class=nx>id</span> <span class=o>==</span> <span class=kc>null</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>               <span class=k>while</span> <span class=p>(</span> <span class=k>this</span><span class=p>.</span><span class=nx>intervalsById</span><span class=p>[</span> <span class=k>this</span><span class=p>.</span><span class=nx>idCandidate</span> <span class=p>]</span> <span class=o>!=</span> <span class=kc>null</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                   <span class=k>this</span><span class=p>.</span><span class=nx>idCandidate</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>               <span class=p>}</span>
</span></span><span class=line><span class=cl>               <span class=nx>id</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>idCandidate</span><span class=p>;</span>
</span></span><span class=line><span class=cl>           <span class=p>}</span>
</span></span><span class=line><span class=cl>           <span class=nx>Util</span><span class=p>.</span><span class=nx>assertNumber</span><span class=p>(</span> <span class=nx>start</span><span class=p>,</span> <span class=s1>&#39;1st argument of IntervalTree#add()&#39;</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>           <span class=nx>Util</span><span class=p>.</span><span class=nx>assertNumber</span><span class=p>(</span> <span class=nx>end</span><span class=p>,</span> <span class=s1>&#39;2nd argument of IntervalTree#add()&#39;</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>           <span class=k>if</span> <span class=p>(</span> <span class=nx>start</span> <span class=o>&gt;=</span> <span class=nx>end</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>               <span class=nx>Util</span><span class=p>.</span><span class=nx>assertOrder</span><span class=p>(</span> <span class=nx>start</span><span class=p>,</span> <span class=nx>end</span><span class=p>,</span> <span class=s1>&#39;start&#39;</span><span class=p>,</span> <span class=s1>&#39;end&#39;</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>           <span class=p>}</span>
</span></span><span class=line><span class=cl>           <span class=nx>interval</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Interval</span><span class=p>(</span> <span class=nx>start</span><span class=p>,</span> <span class=nx>end</span><span class=p>,</span> <span class=nx>id</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>           <span class=k>this</span><span class=p>.</span><span class=nx>pointTree</span><span class=p>.</span><span class=nx>insert</span><span class=p>(</span> <span class=k>new</span> <span class=nx>Point</span><span class=p>(</span> <span class=nx>interval</span><span class=p>.</span><span class=nx>start</span><span class=p>,</span> <span class=nx>id</span> <span class=p>)</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>           <span class=k>this</span><span class=p>.</span><span class=nx>pointTree</span><span class=p>.</span><span class=nx>insert</span><span class=p>(</span> <span class=k>new</span> <span class=nx>Point</span><span class=p>(</span> <span class=nx>interval</span><span class=p>.</span><span class=nx>end</span><span class=p>,</span> <span class=nx>id</span> <span class=p>)</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>           <span class=k>this</span><span class=p>.</span><span class=nx>intervalsById</span><span class=p>[</span> <span class=nx>id</span> <span class=p>]</span> <span class=o>=</span> <span class=nx>interval</span><span class=p>;</span>
</span></span><span class=line><span class=cl>           <span class=k>return</span> <span class=k>this</span><span class=p>.</span><span class=nx>insert</span><span class=p>(</span> <span class=nx>interval</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=nx>root</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>       <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>       search intervals
</span></span></span><span class=line><span class=cl><span class=cm>       when only one argument is given, return intervals which contains the value
</span></span></span><span class=line><span class=cl><span class=cm>       when two arguments are given, ...
</span></span></span><span class=line><span class=cl><span class=cm>  
</span></span></span><span class=line><span class=cl><span class=cm>       @method search
</span></span></span><span class=line><span class=cl><span class=cm>       @public
</span></span></span><span class=line><span class=cl><span class=cm>       @param {Number} val1
</span></span></span><span class=line><span class=cl><span class=cm>       @param {Number} val2
</span></span></span><span class=line><span class=cl><span class=cm>       @return {Array(Interval)} intervals
</span></span></span><span class=line><span class=cl><span class=cm>        */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=nx>IntervalTree</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>search</span> <span class=o>=</span> <span class=kd>function</span><span class=p>(</span> <span class=nx>val1</span><span class=p>,</span> <span class=nx>val2</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>           <span class=nx>Util</span><span class=p>.</span><span class=nx>assertNumber</span><span class=p>(</span> <span class=nx>val1</span><span class=p>,</span> <span class=s1>&#39;1st argument at IntervalTree#search()&#39;</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>           <span class=k>if</span> <span class=p>(</span> <span class=nx>val2</span> <span class=o>==</span> <span class=kc>null</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>               <span class=k>return</span> <span class=k>this</span><span class=p>.</span><span class=nx>pointSearch</span><span class=p>(</span> <span class=nx>val1</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>           <span class=p>}</span>
</span></span><span class=line><span class=cl>           <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>               <span class=nx>Util</span><span class=p>.</span><span class=nx>assertNumber</span><span class=p>(</span> <span class=nx>val2</span><span class=p>,</span> <span class=s1>&#39;2nd argument at IntervalTree#search()&#39;</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>               <span class=nx>Util</span><span class=p>.</span><span class=nx>assertOrder</span><span class=p>(</span> <span class=nx>val1</span><span class=p>,</span> <span class=nx>val2</span><span class=p>,</span> <span class=s1>&#39;1st argument&#39;</span><span class=p>,</span> <span class=s1>&#39;2nd argument&#39;</span><span class=p>,</span> <span class=s1>&#39;IntervalTree#search()&#39;</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>               <span class=k>return</span> <span class=k>this</span><span class=p>.</span><span class=nx>rangeSearch</span><span class=p>(</span> <span class=nx>val1</span><span class=p>,</span> <span class=nx>val2</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>           <span class=p>}</span>
</span></span><span class=line><span class=cl>       <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>       removes an interval of the given id
</span></span></span><span class=line><span class=cl><span class=cm>  
</span></span></span><span class=line><span class=cl><span class=cm>       @method remove
</span></span></span><span class=line><span class=cl><span class=cm>       @public
</span></span></span><span class=line><span class=cl><span class=cm>       @param {Number|String} id id of the interval to remove
</span></span></span><span class=line><span class=cl><span class=cm>        */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=nx>IntervalTree</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>remove</span> <span class=o>=</span> <span class=kd>function</span><span class=p>(</span> <span class=nx>id</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>           <span class=kd>var</span> <span class=nx>interval</span><span class=p>,</span> <span class=nx>node</span><span class=p>;</span>
</span></span><span class=line><span class=cl>           <span class=nx>interval</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>intervalsById</span><span class=p>[</span> <span class=nx>id</span> <span class=p>];</span>
</span></span><span class=line><span class=cl>           <span class=k>if</span> <span class=p>(</span> <span class=nx>interval</span> <span class=o>==</span> <span class=kc>null</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>               <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>           <span class=p>}</span>
</span></span><span class=line><span class=cl>           <span class=nx>node</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>nodesById</span><span class=p>[</span> <span class=nx>id</span> <span class=p>];</span>
</span></span><span class=line><span class=cl>           <span class=nx>node</span><span class=p>.</span><span class=nx>remove</span><span class=p>(</span> <span class=nx>interval</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>           <span class=k>delete</span> <span class=k>this</span><span class=p>.</span><span class=nx>nodesById</span><span class=p>[</span> <span class=nx>id</span> <span class=p>];</span>
</span></span><span class=line><span class=cl>           <span class=k>return</span> <span class=k>delete</span> <span class=k>this</span><span class=p>.</span><span class=nx>intervalsById</span><span class=p>[</span> <span class=nx>id</span> <span class=p>];</span>
</span></span><span class=line><span class=cl>       <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>       search intervals at the given node
</span></span></span><span class=line><span class=cl><span class=cm>  
</span></span></span><span class=line><span class=cl><span class=cm>       @method pointSearch
</span></span></span><span class=line><span class=cl><span class=cm>       @public
</span></span></span><span class=line><span class=cl><span class=cm>       @param {Number} val
</span></span></span><span class=line><span class=cl><span class=cm>       @param {Node} [node] current node to search. default is this.root
</span></span></span><span class=line><span class=cl><span class=cm>       @return {Array(Interval)}
</span></span></span><span class=line><span class=cl><span class=cm>        */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=nx>IntervalTree</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>pointSearch</span> <span class=o>=</span> <span class=kd>function</span><span class=p>(</span> <span class=nx>val</span><span class=p>,</span> <span class=nx>node</span><span class=p>,</span> <span class=nx>results</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>           <span class=k>if</span> <span class=p>(</span> <span class=nx>node</span> <span class=o>==</span> <span class=kc>null</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>               <span class=nx>node</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>root</span><span class=p>;</span>
</span></span><span class=line><span class=cl>           <span class=p>}</span>
</span></span><span class=line><span class=cl>           <span class=k>if</span> <span class=p>(</span> <span class=nx>results</span> <span class=o>==</span> <span class=kc>null</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>               <span class=nx>results</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>           <span class=p>}</span>
</span></span><span class=line><span class=cl>           <span class=nx>Util</span><span class=p>.</span><span class=nx>assertNumber</span><span class=p>(</span> <span class=nx>val</span><span class=p>,</span> <span class=s1>&#39;1st argument of IntervalTree#pointSearch()&#39;</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>           <span class=k>if</span> <span class=p>(</span> <span class=nx>val</span> <span class=o>&lt;</span> <span class=nx>node</span><span class=p>.</span><span class=nx>center</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>               <span class=nx>results</span> <span class=o>=</span> <span class=nx>results</span><span class=p>.</span><span class=nx>concat</span><span class=p>(</span> <span class=nx>node</span><span class=p>.</span><span class=nx>startPointSearch</span><span class=p>(</span> <span class=nx>val</span> <span class=p>)</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>               <span class=k>if</span> <span class=p>(</span> <span class=nx>node</span><span class=p>.</span><span class=nx>left</span> <span class=o>!=</span> <span class=kc>null</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                   <span class=k>return</span> <span class=k>this</span><span class=p>.</span><span class=nx>pointSearch</span><span class=p>(</span> <span class=nx>val</span><span class=p>,</span> <span class=nx>node</span><span class=p>.</span><span class=nx>left</span><span class=p>,</span> <span class=nx>results</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>               <span class=p>}</span>
</span></span><span class=line><span class=cl>               <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                   <span class=k>return</span> <span class=nx>results</span><span class=p>;</span>
</span></span><span class=line><span class=cl>               <span class=p>}</span>
</span></span><span class=line><span class=cl>           <span class=p>}</span>
</span></span><span class=line><span class=cl>           <span class=k>if</span> <span class=p>(</span> <span class=nx>val</span> <span class=o>&gt;</span> <span class=nx>node</span><span class=p>.</span><span class=nx>center</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>               <span class=nx>results</span> <span class=o>=</span> <span class=nx>results</span><span class=p>.</span><span class=nx>concat</span><span class=p>(</span> <span class=nx>node</span><span class=p>.</span><span class=nx>endPointSearch</span><span class=p>(</span> <span class=nx>val</span> <span class=p>)</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>               <span class=k>if</span> <span class=p>(</span> <span class=nx>node</span><span class=p>.</span><span class=nx>right</span> <span class=o>!=</span> <span class=kc>null</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                   <span class=k>return</span> <span class=k>this</span><span class=p>.</span><span class=nx>pointSearch</span><span class=p>(</span> <span class=nx>val</span><span class=p>,</span> <span class=nx>node</span><span class=p>.</span><span class=nx>right</span><span class=p>,</span> <span class=nx>results</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>               <span class=p>}</span>
</span></span><span class=line><span class=cl>               <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                   <span class=k>return</span> <span class=nx>results</span><span class=p>;</span>
</span></span><span class=line><span class=cl>               <span class=p>}</span>
</span></span><span class=line><span class=cl>           <span class=p>}</span>
</span></span><span class=line><span class=cl>           <span class=k>return</span> <span class=nx>results</span><span class=p>.</span><span class=nx>concat</span><span class=p>(</span> <span class=nx>node</span><span class=p>.</span><span class=nx>getAllIntervals</span><span class=p>()</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>       <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>       returns intervals which covers the given start-end interval
</span></span></span><span class=line><span class=cl><span class=cm>  
</span></span></span><span class=line><span class=cl><span class=cm>       @method rangeSearch
</span></span></span><span class=line><span class=cl><span class=cm>       @public
</span></span></span><span class=line><span class=cl><span class=cm>       @param {Number} start start of the interval
</span></span></span><span class=line><span class=cl><span class=cm>       @param {Number} end end of the interval
</span></span></span><span class=line><span class=cl><span class=cm>       @return {Array(Interval)}
</span></span></span><span class=line><span class=cl><span class=cm>        */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=nx>IntervalTree</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>rangeSearch</span> <span class=o>=</span> <span class=kd>function</span><span class=p>(</span> <span class=nx>start</span><span class=p>,</span> <span class=nx>end</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>           <span class=kd>var</span> <span class=nx>firstPos</span><span class=p>,</span> <span class=nx>i</span><span class=p>,</span> <span class=nx>id</span><span class=p>,</span> <span class=nx>interval</span><span class=p>,</span> <span class=nx>j</span><span class=p>,</span> <span class=nx>lastPos</span><span class=p>,</span> <span class=nx>len</span><span class=p>,</span> <span class=nx>len1</span><span class=p>,</span> <span class=nx>point</span><span class=p>,</span> <span class=nx>ref</span><span class=p>,</span> <span class=nx>ref1</span><span class=p>,</span> <span class=nx>resultsById</span><span class=p>;</span>
</span></span><span class=line><span class=cl>           <span class=nx>Util</span><span class=p>.</span><span class=nx>assertNumber</span><span class=p>(</span> <span class=nx>start</span><span class=p>,</span> <span class=s1>&#39;1st argument at IntervalTree#rangeSearch()&#39;</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>           <span class=nx>Util</span><span class=p>.</span><span class=nx>assertNumber</span><span class=p>(</span> <span class=nx>end</span><span class=p>,</span> <span class=s1>&#39;2nd argument at IntervalTree#rangeSearch()&#39;</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>           <span class=nx>Util</span><span class=p>.</span><span class=nx>assertOrder</span><span class=p>(</span> <span class=nx>start</span><span class=p>,</span> <span class=nx>end</span><span class=p>,</span> <span class=s1>&#39;1st argument&#39;</span><span class=p>,</span> <span class=s1>&#39;2nd argument&#39;</span><span class=p>,</span> <span class=s1>&#39;IntervalTree#rangeSearch()&#39;</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>           <span class=nx>resultsById</span> <span class=o>=</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>           <span class=nx>ref</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>pointSearch</span><span class=p>(</span> <span class=nx>start</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>           <span class=k>for</span> <span class=p>(</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span> <span class=nx>len</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=nx>len</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>               <span class=nx>interval</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>[</span> <span class=nx>i</span> <span class=p>];</span>
</span></span><span class=line><span class=cl>               <span class=nx>resultsById</span><span class=p>[</span> <span class=nx>interval</span><span class=p>.</span><span class=nx>id</span> <span class=p>]</span> <span class=o>=</span> <span class=nx>interval</span><span class=p>;</span>
</span></span><span class=line><span class=cl>           <span class=p>}</span>
</span></span><span class=line><span class=cl>           <span class=nx>firstPos</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>pointTree</span><span class=p>.</span><span class=nx>firstPositionOf</span><span class=p>(</span> <span class=k>new</span> <span class=nx>Point</span><span class=p>(</span> <span class=nx>start</span> <span class=p>)</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>           <span class=nx>lastPos</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>pointTree</span><span class=p>.</span><span class=nx>lastPositionOf</span><span class=p>(</span> <span class=k>new</span> <span class=nx>Point</span><span class=p>(</span> <span class=nx>end</span> <span class=p>)</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>           <span class=nx>ref1</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>pointTree</span><span class=p>.</span><span class=nx>slice</span><span class=p>(</span> <span class=nx>firstPos</span><span class=p>,</span> <span class=nx>lastPos</span> <span class=o>+</span> <span class=mi>1</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>           <span class=k>for</span> <span class=p>(</span> <span class=nx>j</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span> <span class=nx>len1</span> <span class=o>=</span> <span class=nx>ref1</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span> <span class=nx>j</span> <span class=o>&lt;</span> <span class=nx>len1</span><span class=p>;</span> <span class=nx>j</span><span class=o>++</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>               <span class=nx>point</span> <span class=o>=</span> <span class=nx>ref1</span><span class=p>[</span> <span class=nx>j</span> <span class=p>];</span>
</span></span><span class=line><span class=cl>               <span class=nx>resultsById</span><span class=p>[</span> <span class=nx>point</span><span class=p>.</span><span class=nx>id</span> <span class=p>]</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>intervalsById</span><span class=p>[</span> <span class=nx>point</span><span class=p>.</span><span class=nx>id</span> <span class=p>];</span>
</span></span><span class=line><span class=cl>           <span class=p>}</span>
</span></span><span class=line><span class=cl>           <span class=k>return</span> <span class=p>(</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>               <span class=kd>var</span> <span class=nx>results1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>               <span class=nx>results1</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>               <span class=k>for</span> <span class=p>(</span> <span class=nx>id</span> <span class=k>in</span> <span class=nx>resultsById</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                   <span class=nx>interval</span> <span class=o>=</span> <span class=nx>resultsById</span><span class=p>[</span> <span class=nx>id</span> <span class=p>];</span>
</span></span><span class=line><span class=cl>                   <span class=nx>results1</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span> <span class=nx>interval</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>               <span class=p>}</span>
</span></span><span class=line><span class=cl>               <span class=k>return</span> <span class=nx>results1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>           <span class=p>}</span> <span class=p>)();</span>
</span></span><span class=line><span class=cl>       <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>       insert interval to the given node
</span></span></span><span class=line><span class=cl><span class=cm>  
</span></span></span><span class=line><span class=cl><span class=cm>       @method insert
</span></span></span><span class=line><span class=cl><span class=cm>       @private
</span></span></span><span class=line><span class=cl><span class=cm>       @param {Interval} interval
</span></span></span><span class=line><span class=cl><span class=cm>       @param {Node} node node to insert the interval
</span></span></span><span class=line><span class=cl><span class=cm>       @return {Interval} inserted interval
</span></span></span><span class=line><span class=cl><span class=cm>        */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=nx>IntervalTree</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>insert</span> <span class=o>=</span> <span class=kd>function</span><span class=p>(</span> <span class=nx>interval</span><span class=p>,</span> <span class=nx>node</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>           <span class=k>if</span> <span class=p>(</span> <span class=nx>interval</span><span class=p>.</span><span class=nx>end</span> <span class=o>&lt;</span> <span class=nx>node</span><span class=p>.</span><span class=nx>center</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>               <span class=k>if</span> <span class=p>(</span> <span class=nx>node</span><span class=p>.</span><span class=nx>left</span> <span class=o>==</span> <span class=kc>null</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                   <span class=nx>node</span><span class=p>.</span><span class=nx>left</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>createNode</span><span class=p>(</span> <span class=nx>interval</span><span class=p>.</span><span class=nx>end</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>               <span class=p>}</span>
</span></span><span class=line><span class=cl>               <span class=k>return</span> <span class=k>this</span><span class=p>.</span><span class=nx>insert</span><span class=p>(</span> <span class=nx>interval</span><span class=p>,</span> <span class=nx>node</span><span class=p>.</span><span class=nx>left</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>           <span class=p>}</span>
</span></span><span class=line><span class=cl>           <span class=k>if</span> <span class=p>(</span> <span class=nx>node</span><span class=p>.</span><span class=nx>center</span> <span class=o>&lt;</span> <span class=nx>interval</span><span class=p>.</span><span class=nx>start</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>               <span class=k>if</span> <span class=p>(</span> <span class=nx>node</span><span class=p>.</span><span class=nx>right</span> <span class=o>==</span> <span class=kc>null</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                   <span class=nx>node</span><span class=p>.</span><span class=nx>right</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>createNode</span><span class=p>(</span> <span class=nx>interval</span><span class=p>.</span><span class=nx>start</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>               <span class=p>}</span>
</span></span><span class=line><span class=cl>               <span class=k>return</span> <span class=k>this</span><span class=p>.</span><span class=nx>insert</span><span class=p>(</span> <span class=nx>interval</span><span class=p>,</span> <span class=nx>node</span><span class=p>.</span><span class=nx>right</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>           <span class=p>}</span>
</span></span><span class=line><span class=cl>           <span class=nx>node</span><span class=p>.</span><span class=nx>insert</span><span class=p>(</span> <span class=nx>interval</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>           <span class=k>this</span><span class=p>.</span><span class=nx>nodesById</span><span class=p>[</span> <span class=nx>interval</span><span class=p>.</span><span class=nx>id</span> <span class=p>]</span> <span class=o>=</span> <span class=nx>node</span><span class=p>;</span>
</span></span><span class=line><span class=cl>           <span class=k>return</span> <span class=nx>interval</span><span class=p>;</span>
</span></span><span class=line><span class=cl>       <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>       create node by center
</span></span></span><span class=line><span class=cl><span class=cm>  
</span></span></span><span class=line><span class=cl><span class=cm>       @method createNode
</span></span></span><span class=line><span class=cl><span class=cm>       @private
</span></span></span><span class=line><span class=cl><span class=cm>       @param {Number} center
</span></span></span><span class=line><span class=cl><span class=cm>       @return {Node} node
</span></span></span><span class=line><span class=cl><span class=cm>        */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=nx>IntervalTree</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>createNode</span> <span class=o>=</span> <span class=kd>function</span><span class=p>(</span> <span class=nx>center</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>           <span class=kd>var</span> <span class=nx>node</span><span class=p>;</span>
</span></span><span class=line><span class=cl>           <span class=nx>node</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Node</span><span class=p>(</span> <span class=nx>center</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>           <span class=k>this</span><span class=p>.</span><span class=nx>nodesByCenter</span><span class=p>[</span> <span class=nx>center</span> <span class=p>]</span> <span class=o>=</span> <span class=nx>node</span><span class=p>;</span>
</span></span><span class=line><span class=cl>           <span class=k>return</span> <span class=nx>node</span><span class=p>;</span>
</span></span><span class=line><span class=cl>       <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=k>return</span> <span class=nx>IntervalTree</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   <span class=p>}</span> <span class=p>)();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   <span class=kd>var</span> <span class=nx>Util</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   <span class=nx>Util</span> <span class=o>=</span> <span class=p>(</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>       <span class=kd>function</span> <span class=nx>Util</span><span class=p>()</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=nx>Util</span><span class=p>.</span><span class=nx>assertNumber</span> <span class=o>=</span> <span class=kd>function</span><span class=p>(</span> <span class=nx>val</span><span class=p>,</span> <span class=nx>desc</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>           <span class=k>if</span> <span class=p>(</span> <span class=nx>val</span> <span class=o>==</span> <span class=kc>null</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>               <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span> <span class=nx>desc</span> <span class=o>+</span> <span class=s1>&#39; is required.&#39;</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>           <span class=p>}</span>
</span></span><span class=line><span class=cl>           <span class=k>if</span> <span class=p>(</span> <span class=k>typeof</span> <span class=nx>val</span> <span class=o>!==</span> <span class=s1>&#39;number&#39;</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>               <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span> <span class=nx>desc</span> <span class=o>+</span> <span class=s1>&#39; must be a number.&#39;</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>           <span class=p>}</span>
</span></span><span class=line><span class=cl>       <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=nx>Util</span><span class=p>.</span><span class=nx>assertOrder</span> <span class=o>=</span> <span class=kd>function</span><span class=p>(</span> <span class=nx>start</span><span class=p>,</span> <span class=nx>end</span><span class=p>,</span> <span class=nx>startName</span><span class=p>,</span> <span class=nx>endName</span><span class=p>,</span> <span class=nx>desc</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>           <span class=k>if</span> <span class=p>(</span> <span class=nx>start</span> <span class=o>&gt;=</span> <span class=nx>end</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>               <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span> <span class=nx>desc</span> <span class=o>+</span> <span class=s2>&#34;: &#34;</span> <span class=o>+</span> <span class=nx>startName</span> <span class=o>+</span> <span class=s2>&#34;(&#34;</span> <span class=o>+</span> <span class=nx>start</span> <span class=o>+</span> <span class=s2>&#34;) must be smaller than &#34;</span> <span class=o>+</span> <span class=nx>endName</span> <span class=o>+</span> <span class=s2>&#34;(&#34;</span> <span class=o>+</span> <span class=nx>end</span> <span class=o>+</span> <span class=s2>&#34;).&#34;</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>           <span class=p>}</span>
</span></span><span class=line><span class=cl>       <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=k>return</span> <span class=nx>Util</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   <span class=p>}</span> <span class=p>)();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>   extended array of objects, always sorted
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>   @class SortedList
</span></span></span><span class=line><span class=cl><span class=cm>   @extends Array
</span></span></span><span class=line><span class=cl><span class=cm>   @module interval-tree2
</span></span></span><span class=line><span class=cl><span class=cm>    */</span>
</span></span><span class=line><span class=cl>   <span class=kd>var</span> <span class=nx>SortedList</span><span class=p>,</span>
</span></span><span class=line><span class=cl>       <span class=nx>extend</span> <span class=o>=</span> <span class=kd>function</span><span class=p>(</span> <span class=nx>child</span><span class=p>,</span> <span class=nx>parent</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>           <span class=k>for</span> <span class=p>(</span> <span class=kd>var</span> <span class=nx>key</span> <span class=k>in</span> <span class=nx>parent</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>               <span class=k>if</span> <span class=p>(</span> <span class=nx>hasProp</span><span class=p>.</span><span class=nx>call</span><span class=p>(</span> <span class=nx>parent</span><span class=p>,</span> <span class=nx>key</span> <span class=p>)</span> <span class=p>)</span> <span class=nx>child</span><span class=p>[</span> <span class=nx>key</span> <span class=p>]</span> <span class=o>=</span> <span class=nx>parent</span><span class=p>[</span> <span class=nx>key</span> <span class=p>];</span>
</span></span><span class=line><span class=cl>           <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>           <span class=kd>function</span> <span class=nx>ctor</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>               <span class=k>this</span><span class=p>.</span><span class=nx>constructor</span> <span class=o>=</span> <span class=nx>child</span><span class=p>;</span>
</span></span><span class=line><span class=cl>           <span class=p>}</span>
</span></span><span class=line><span class=cl>           <span class=nx>ctor</span><span class=p>.</span><span class=nx>prototype</span> <span class=o>=</span> <span class=nx>parent</span><span class=p>.</span><span class=nx>prototype</span><span class=p>;</span>
</span></span><span class=line><span class=cl>           <span class=nx>child</span><span class=p>.</span><span class=nx>prototype</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>ctor</span><span class=p>();</span>
</span></span><span class=line><span class=cl>           <span class=nx>child</span><span class=p>.</span><span class=nx>__super__</span> <span class=o>=</span> <span class=nx>parent</span><span class=p>.</span><span class=nx>prototype</span><span class=p>;</span>
</span></span><span class=line><span class=cl>           <span class=k>return</span> <span class=nx>child</span><span class=p>;</span>
</span></span><span class=line><span class=cl>       <span class=p>},</span>
</span></span><span class=line><span class=cl>       <span class=nx>hasProp</span> <span class=o>=</span> <span class=p>{}.</span><span class=nx>hasOwnProperty</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   <span class=nx>SortedList</span> <span class=o>=</span> <span class=p>(</span> <span class=kd>function</span><span class=p>(</span> <span class=nx>superClass</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>       <span class=nx>extend</span><span class=p>(</span> <span class=nx>SortedList</span><span class=p>,</span> <span class=nx>superClass</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>       @constructor
</span></span></span><span class=line><span class=cl><span class=cm>       @param {String} compareKey key name to compare objects. The value of the key must be a number.
</span></span></span><span class=line><span class=cl><span class=cm>        */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>       key name to compare objects. The value of the key must be a number.
</span></span></span><span class=line><span class=cl><span class=cm>       @property {String} compareKey
</span></span></span><span class=line><span class=cl><span class=cm>        */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=kd>function</span> <span class=nx>SortedList</span><span class=p>(</span> <span class=nx>compareKey</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>           <span class=k>this</span><span class=p>.</span><span class=nx>compareKey</span> <span class=o>=</span> <span class=nx>compareKey</span><span class=p>;</span>
</span></span><span class=line><span class=cl>       <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>       insert a value
</span></span></span><span class=line><span class=cl><span class=cm>      
</span></span></span><span class=line><span class=cl><span class=cm>       @method insert
</span></span></span><span class=line><span class=cl><span class=cm>       @param {any} val
</span></span></span><span class=line><span class=cl><span class=cm>       @return {Number} inserted position
</span></span></span><span class=line><span class=cl><span class=cm>        */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=nx>SortedList</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>insert</span> <span class=o>=</span> <span class=kd>function</span><span class=p>(</span> <span class=nx>val</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>           <span class=kd>var</span> <span class=nx>pos</span><span class=p>;</span>
</span></span><span class=line><span class=cl>           <span class=nx>pos</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>bsearch</span><span class=p>(</span> <span class=nx>val</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>           <span class=k>this</span><span class=p>.</span><span class=nx>splice</span><span class=p>(</span> <span class=nx>pos</span> <span class=o>+</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=nx>val</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>           <span class=k>return</span> <span class=nx>pos</span> <span class=o>+</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>       <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>       remove the value in the given position
</span></span></span><span class=line><span class=cl><span class=cm>      
</span></span></span><span class=line><span class=cl><span class=cm>       @method remove
</span></span></span><span class=line><span class=cl><span class=cm>       @param {Number} pos position
</span></span></span><span class=line><span class=cl><span class=cm>       @return {SortedList} self
</span></span></span><span class=line><span class=cl><span class=cm>        */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=nx>SortedList</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>remove</span> <span class=o>=</span> <span class=kd>function</span><span class=p>(</span> <span class=nx>pos</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>           <span class=k>this</span><span class=p>.</span><span class=nx>splice</span><span class=p>(</span> <span class=nx>pos</span><span class=p>,</span> <span class=mi>1</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>           <span class=k>return</span> <span class=k>this</span><span class=p>;</span>
</span></span><span class=line><span class=cl>       <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>       get maximum value in the list
</span></span></span><span class=line><span class=cl><span class=cm>      
</span></span></span><span class=line><span class=cl><span class=cm>       @method max
</span></span></span><span class=line><span class=cl><span class=cm>       @return {Number}
</span></span></span><span class=line><span class=cl><span class=cm>        */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=nx>SortedList</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>max</span> <span class=o>=</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>           <span class=kd>var</span> <span class=nx>ref</span><span class=p>;</span>
</span></span><span class=line><span class=cl>           <span class=k>return</span> <span class=p>(</span> <span class=nx>ref</span> <span class=o>=</span> <span class=k>this</span><span class=p>[</span> <span class=k>this</span><span class=p>.</span><span class=nx>length</span> <span class=o>-</span> <span class=mi>1</span> <span class=p>]</span> <span class=p>)</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>?</span> <span class=nx>ref</span><span class=p>[</span> <span class=k>this</span><span class=p>.</span><span class=nx>compareKey</span> <span class=p>]</span> <span class=o>:</span> <span class=k>void</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>       <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>       get minimum value in the list
</span></span></span><span class=line><span class=cl><span class=cm>      
</span></span></span><span class=line><span class=cl><span class=cm>       @method min
</span></span></span><span class=line><span class=cl><span class=cm>       @return {Number}
</span></span></span><span class=line><span class=cl><span class=cm>        */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=nx>SortedList</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>min</span> <span class=o>=</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>           <span class=kd>var</span> <span class=nx>ref</span><span class=p>;</span>
</span></span><span class=line><span class=cl>           <span class=k>return</span> <span class=p>(</span> <span class=nx>ref</span> <span class=o>=</span> <span class=k>this</span><span class=p>[</span> <span class=mi>0</span> <span class=p>]</span> <span class=p>)</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>?</span> <span class=nx>ref</span><span class=p>[</span> <span class=k>this</span><span class=p>.</span><span class=nx>compareKey</span> <span class=p>]</span> <span class=o>:</span> <span class=k>void</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>       <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>       binary search
</span></span></span><span class=line><span class=cl><span class=cm>      
</span></span></span><span class=line><span class=cl><span class=cm>       @method bsearch
</span></span></span><span class=line><span class=cl><span class=cm>       @param {any} val
</span></span></span><span class=line><span class=cl><span class=cm>       @return {Number} position of the value
</span></span></span><span class=line><span class=cl><span class=cm>        */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=nx>SortedList</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>bsearch</span> <span class=o>=</span> <span class=kd>function</span><span class=p>(</span> <span class=nx>val</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>           <span class=kd>var</span> <span class=nx>comp</span><span class=p>,</span> <span class=nx>epos</span><span class=p>,</span> <span class=nx>mpos</span><span class=p>,</span> <span class=nx>mval</span><span class=p>,</span> <span class=nx>spos</span><span class=p>;</span>
</span></span><span class=line><span class=cl>           <span class=k>if</span> <span class=p>(</span> <span class=o>!</span><span class=k>this</span><span class=p>.</span><span class=nx>length</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>               <span class=k>return</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>           <span class=p>}</span>
</span></span><span class=line><span class=cl>           <span class=nx>mpos</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl>           <span class=nx>mval</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl>           <span class=nx>spos</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>           <span class=nx>epos</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span>
</span></span><span class=line><span class=cl>           <span class=k>while</span> <span class=p>(</span> <span class=nx>epos</span> <span class=o>-</span> <span class=nx>spos</span> <span class=o>&gt;</span> <span class=mi>1</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>               <span class=nx>mpos</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>floor</span><span class=p>(</span> <span class=p>(</span> <span class=nx>spos</span> <span class=o>+</span> <span class=nx>epos</span> <span class=p>)</span> <span class=o>/</span> <span class=mi>2</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>               <span class=nx>mval</span> <span class=o>=</span> <span class=k>this</span><span class=p>[</span> <span class=nx>mpos</span> <span class=p>];</span>
</span></span><span class=line><span class=cl>               <span class=nx>comp</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>compare</span><span class=p>(</span> <span class=nx>val</span><span class=p>,</span> <span class=nx>mval</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>               <span class=k>if</span> <span class=p>(</span> <span class=nx>comp</span> <span class=o>===</span> <span class=mi>0</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                   <span class=k>return</span> <span class=nx>mpos</span><span class=p>;</span>
</span></span><span class=line><span class=cl>               <span class=p>}</span>
</span></span><span class=line><span class=cl>               <span class=k>if</span> <span class=p>(</span> <span class=nx>comp</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                   <span class=nx>spos</span> <span class=o>=</span> <span class=nx>mpos</span><span class=p>;</span>
</span></span><span class=line><span class=cl>               <span class=p>}</span>
</span></span><span class=line><span class=cl>               <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                   <span class=nx>epos</span> <span class=o>=</span> <span class=nx>mpos</span><span class=p>;</span>
</span></span><span class=line><span class=cl>               <span class=p>}</span>
</span></span><span class=line><span class=cl>           <span class=p>}</span>
</span></span><span class=line><span class=cl>           <span class=k>if</span> <span class=p>(</span> <span class=nx>spos</span> <span class=o>===</span> <span class=mi>0</span> <span class=o>&amp;&amp;</span> <span class=k>this</span><span class=p>.</span><span class=nx>compare</span><span class=p>(</span> <span class=k>this</span><span class=p>[</span> <span class=mi>0</span> <span class=p>],</span> <span class=nx>val</span> <span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>               <span class=k>return</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>           <span class=p>}</span>
</span></span><span class=line><span class=cl>           <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>               <span class=k>return</span> <span class=nx>spos</span><span class=p>;</span>
</span></span><span class=line><span class=cl>           <span class=p>}</span>
</span></span><span class=line><span class=cl>       <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>       leftmost position of the given val
</span></span></span><span class=line><span class=cl><span class=cm>      
</span></span></span><span class=line><span class=cl><span class=cm>       @method firstPositionOf
</span></span></span><span class=line><span class=cl><span class=cm>       @param {any} val
</span></span></span><span class=line><span class=cl><span class=cm>       @return {Number} leftmost position of the value
</span></span></span><span class=line><span class=cl><span class=cm>        */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=nx>SortedList</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>firstPositionOf</span> <span class=o>=</span> <span class=kd>function</span><span class=p>(</span> <span class=nx>val</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>           <span class=kd>var</span> <span class=nx>index</span><span class=p>,</span> <span class=nx>num</span><span class=p>,</span> <span class=nx>ref</span><span class=p>;</span>
</span></span><span class=line><span class=cl>           <span class=nx>index</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>bsearch</span><span class=p>(</span> <span class=nx>val</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>           <span class=k>if</span> <span class=p>(</span> <span class=nx>index</span> <span class=o>===</span> <span class=o>-</span><span class=mi>1</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>               <span class=k>return</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>           <span class=p>}</span>
</span></span><span class=line><span class=cl>           <span class=nx>num</span> <span class=o>=</span> <span class=nx>val</span><span class=p>[</span> <span class=k>this</span><span class=p>.</span><span class=nx>compareKey</span> <span class=p>];</span>
</span></span><span class=line><span class=cl>           <span class=k>if</span> <span class=p>(</span> <span class=nx>num</span> <span class=o>===</span> <span class=p>(</span> <span class=p>(</span> <span class=nx>ref</span> <span class=o>=</span> <span class=k>this</span><span class=p>[</span> <span class=nx>index</span> <span class=p>]</span> <span class=p>)</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>?</span> <span class=nx>ref</span><span class=p>[</span> <span class=k>this</span><span class=p>.</span><span class=nx>compareKey</span> <span class=p>]</span> <span class=o>:</span> <span class=k>void</span> <span class=mi>0</span> <span class=p>)</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>               <span class=k>while</span> <span class=p>(</span> <span class=kc>true</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                   <span class=k>if</span> <span class=p>(</span> <span class=nx>index</span> <span class=o>&lt;=</span> <span class=mi>0</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                       <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                   <span class=p>}</span>
</span></span><span class=line><span class=cl>                   <span class=k>if</span> <span class=p>(</span> <span class=k>this</span><span class=p>[</span> <span class=nx>index</span> <span class=o>-</span> <span class=mi>1</span> <span class=p>][</span> <span class=k>this</span><span class=p>.</span><span class=nx>compareKey</span> <span class=p>]</span> <span class=o>&lt;</span> <span class=nx>num</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                       <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                   <span class=p>}</span>
</span></span><span class=line><span class=cl>                   <span class=nx>index</span><span class=o>--</span><span class=p>;</span>
</span></span><span class=line><span class=cl>               <span class=p>}</span>
</span></span><span class=line><span class=cl>           <span class=p>}</span>
</span></span><span class=line><span class=cl>           <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>               <span class=nx>index</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>           <span class=p>}</span>
</span></span><span class=line><span class=cl>           <span class=k>return</span> <span class=nx>index</span><span class=p>;</span>
</span></span><span class=line><span class=cl>       <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>       rightmost position of the given val
</span></span></span><span class=line><span class=cl><span class=cm>      
</span></span></span><span class=line><span class=cl><span class=cm>       @method lastPositionOf
</span></span></span><span class=line><span class=cl><span class=cm>       @param {any} val
</span></span></span><span class=line><span class=cl><span class=cm>       @return {Number} rightmost position of the value
</span></span></span><span class=line><span class=cl><span class=cm>        */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=nx>SortedList</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>lastPositionOf</span> <span class=o>=</span> <span class=kd>function</span><span class=p>(</span> <span class=nx>val</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>           <span class=kd>var</span> <span class=nx>index</span><span class=p>,</span> <span class=nx>num</span><span class=p>;</span>
</span></span><span class=line><span class=cl>           <span class=nx>index</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>bsearch</span><span class=p>(</span> <span class=nx>val</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>           <span class=k>if</span> <span class=p>(</span> <span class=nx>index</span> <span class=o>===</span> <span class=o>-</span><span class=mi>1</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>               <span class=k>return</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>           <span class=p>}</span>
</span></span><span class=line><span class=cl>           <span class=nx>num</span> <span class=o>=</span> <span class=nx>val</span><span class=p>[</span> <span class=k>this</span><span class=p>.</span><span class=nx>compareKey</span> <span class=p>];</span>
</span></span><span class=line><span class=cl>           <span class=k>if</span> <span class=p>(</span> <span class=nx>index</span> <span class=o>===</span> <span class=k>this</span><span class=p>.</span><span class=nx>length</span> <span class=o>-</span> <span class=mi>1</span> <span class=o>&amp;&amp;</span> <span class=nx>num</span> <span class=o>&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>max</span><span class=p>()</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>               <span class=k>return</span> <span class=nx>index</span> <span class=o>+</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>           <span class=p>}</span>
</span></span><span class=line><span class=cl>           <span class=k>while</span> <span class=p>(</span> <span class=kc>true</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>               <span class=k>if</span> <span class=p>(</span> <span class=nx>index</span> <span class=o>+</span> <span class=mi>1</span> <span class=o>&gt;=</span> <span class=k>this</span><span class=p>.</span><span class=nx>length</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                   <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>               <span class=p>}</span>
</span></span><span class=line><span class=cl>               <span class=k>if</span> <span class=p>(</span> <span class=k>this</span><span class=p>[</span> <span class=nx>index</span> <span class=o>+</span> <span class=mi>1</span> <span class=p>][</span> <span class=k>this</span><span class=p>.</span><span class=nx>compareKey</span> <span class=p>]</span> <span class=o>&gt;</span> <span class=nx>num</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                   <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>               <span class=p>}</span>
</span></span><span class=line><span class=cl>               <span class=nx>index</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>           <span class=p>}</span>
</span></span><span class=line><span class=cl>           <span class=k>return</span> <span class=nx>index</span><span class=p>;</span>
</span></span><span class=line><span class=cl>       <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>        * sorted.toArray()
</span></span></span><span class=line><span class=cl><span class=cm>        * get raw array
</span></span></span><span class=line><span class=cl><span class=cm>        *
</span></span></span><span class=line><span class=cl><span class=cm>        */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=nx>SortedList</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>toArray</span> <span class=o>=</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>           <span class=k>return</span> <span class=k>this</span><span class=p>.</span><span class=nx>slice</span><span class=p>();</span>
</span></span><span class=line><span class=cl>       <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>       comparison function. Compares two objects by this.compareKey
</span></span></span><span class=line><span class=cl><span class=cm>      
</span></span></span><span class=line><span class=cl><span class=cm>       @method compare
</span></span></span><span class=line><span class=cl><span class=cm>       @private
</span></span></span><span class=line><span class=cl><span class=cm>       @param {any} a
</span></span></span><span class=line><span class=cl><span class=cm>       @param {any} b
</span></span></span><span class=line><span class=cl><span class=cm>        */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=nx>SortedList</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>compare</span> <span class=o>=</span> <span class=kd>function</span><span class=p>(</span> <span class=nx>a</span><span class=p>,</span> <span class=nx>b</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>           <span class=kd>var</span> <span class=nx>c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>           <span class=k>if</span> <span class=p>(</span> <span class=nx>a</span> <span class=o>==</span> <span class=kc>null</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>               <span class=k>return</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>           <span class=p>}</span>
</span></span><span class=line><span class=cl>           <span class=k>if</span> <span class=p>(</span> <span class=nx>b</span> <span class=o>==</span> <span class=kc>null</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>               <span class=k>return</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>           <span class=p>}</span>
</span></span><span class=line><span class=cl>           <span class=nx>c</span> <span class=o>=</span> <span class=nx>a</span><span class=p>[</span> <span class=k>this</span><span class=p>.</span><span class=nx>compareKey</span> <span class=p>]</span> <span class=o>-</span> <span class=nx>b</span><span class=p>[</span> <span class=k>this</span><span class=p>.</span><span class=nx>compareKey</span> <span class=p>];</span>
</span></span><span class=line><span class=cl>           <span class=k>if</span> <span class=p>(</span> <span class=nx>c</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>               <span class=k>return</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>           <span class=p>}</span>
</span></span><span class=line><span class=cl>           <span class=k>else</span> <span class=k>if</span> <span class=p>(</span> <span class=nx>c</span> <span class=o>===</span> <span class=mi>0</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>               <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>           <span class=p>}</span>
</span></span><span class=line><span class=cl>           <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>               <span class=k>return</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>           <span class=p>}</span>
</span></span><span class=line><span class=cl>       <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=k>return</span> <span class=nx>SortedList</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   <span class=p>}</span> <span class=p>)(</span> <span class=nb>Array</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   <span class=kd>var</span> <span class=nx>Point</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   <span class=nx>Point</span> <span class=o>=</span> <span class=p>(</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>       @constructor
</span></span></span><span class=line><span class=cl><span class=cm>       @param {Number} val number
</span></span></span><span class=line><span class=cl><span class=cm>       @param {Number|String} id id
</span></span></span><span class=line><span class=cl><span class=cm>        */</span>
</span></span><span class=line><span class=cl>       <span class=kd>function</span> <span class=nx>Point</span><span class=p>(</span> <span class=nx>val</span><span class=p>,</span> <span class=nx>id</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>           <span class=k>this</span><span class=p>.</span><span class=nx>val</span> <span class=o>=</span> <span class=nx>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl>           <span class=k>this</span><span class=p>.</span><span class=nx>id</span> <span class=o>=</span> <span class=nx>id</span><span class=p>;</span>
</span></span><span class=line><span class=cl>       <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=k>return</span> <span class=nx>Point</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   <span class=p>}</span> <span class=p>)();</span>
</span></span></code></pre></div><p> </p></div><div class="my-16 border-b border-gray-300"></div><div class="mb-16 text-center max-w-3xl mx-auto"><a class="outline-none bg-transparent dark:bg-gray-800 text-green-700 dark:text-green-500 font-semibold hover:text-white dark:hover:text-gray-800 dark:focus:text-gray-800 hover:bg-green-500 dark:hover:bg-green-500 dark:focus:bg-green-500 focus:text-white focus:bg-green-500 py-2 px-4 border border-green-500 dark:border-none hover:border-transparent rounded block mb-4 transition duration-100" href=https://javifm.com/blog/suscribirse-de-manera-segura-a-eventos-con-jquery/>&#171; Suscribirse de manera segura a eventos con jQuery
</a><a class="outline-none bg-transparent dark:bg-gray-800 text-green-700 dark:text-green-500 font-semibold hover:text-white dark:hover:text-gray-800 dark:focus:text-gray-800 hover:bg-green-500 dark:hover:bg-green-500 dark:focus:bg-green-500 focus:text-white focus:bg-green-500 py-2 px-4 border border-green-500 dark:border-none hover:border-transparent rounded block mb-4 transition duration-100" href=https://javifm.com/blog/reemplazando-atributos-html-con-sublime/>Reemplazando atributos HTML con Sublime &#187;</a></div></article></main><footer class="bg-gray-800 text-gray-200 p-4"><div class="container mx-auto flex justify-between items-center"><p>&copy; 2021 Sitio construido con <a class="text-white underline" href=https://gohugo.io/>Hugo</a> alojado en <a class="text-white underline" href=https://github.com/>Github</a>.</p><div class="flex items-center"><a href=https://github.com/javifm86 class="mr-1 p-2 text-gray-300 hover:text-white"><span class=sr-only>Github</span>
<svg class="w-8 h-8 pointer-events-none" viewBox="0 0 256 250" role="img" aria-labelledby="titleId" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid"><title id="titleId">Github</title><path role="presentation" class="fill-current" d="M128.001.0C57.317.0.0 57.307.0 128.001c0 56.554 36.676 104.535 87.535 121.46 6.397 1.185 8.746-2.777 8.746-6.158.0-3.052-.12-13.135-.174-23.83-35.61 7.742-43.124-15.103-43.124-15.103-5.823-14.795-14.213-18.73-14.213-18.73-11.613-7.944.876-7.78.876-7.78 12.853.902 19.621 13.19 19.621 13.19 11.417 19.568 29.945 13.911 37.249 10.64 1.149-8.272 4.466-13.92 8.127-17.116-28.431-3.236-58.318-14.212-58.318-63.258.0-13.975 5-25.394 13.188-34.358-1.329-3.224-5.71-16.242 1.24-33.874.0.0 10.749-3.44 35.21 13.121 10.21-2.836 21.16-4.258 32.038-4.307 10.878.049 21.837 1.47 32.066 4.307 24.431-16.56 35.165-13.12 35.165-13.12 6.967 17.63 2.584 30.65 1.255 33.873 8.207 8.964 13.173 20.383 13.173 34.358.0 49.163-29.944 59.988-58.447 63.157 4.591 3.972 8.682 11.762 8.682 23.704.0 17.126-.148 30.91-.148 35.126.0 3.407 2.304 7.398 8.792 6.14C219.37 232.5 256 184.537 256 128.002 256 57.307 198.691.0 128.001.0zm-80.06 182.34c-.282.636-1.283.827-2.194.39-.929-.417-1.45-1.284-1.15-1.922.276-.655 1.279-.838 2.205-.399.93.418 1.46 1.293 1.139 1.931zm6.296 5.618c-.61.566-1.804.303-2.614-.591-.837-.892-.994-2.086-.375-2.66.63-.566 1.787-.301 2.626.591.838.903 1 2.088.363 2.66zm4.32 7.188c-.785.545-2.067.034-2.86-1.104-.784-1.138-.784-2.503.017-3.05.795-.547 2.058-.055 2.861 1.075.782 1.157.782 2.522-.019 3.08zm7.304 8.325c-.701.774-2.196.566-3.29-.49-1.119-1.032-1.43-2.496-.726-3.27.71-.776 2.213-.558 3.315.49 1.11 1.03 1.45 2.505.701 3.27zm9.442 2.81c-.31 1.003-1.75 1.459-3.199 1.033-1.448-.439-2.395-1.613-2.103-2.626.301-1.01 1.747-1.484 3.207-1.028 1.446.436 2.396 1.602 2.095 2.622zm10.744 1.193c.036 1.055-1.193 1.93-2.715 1.95-1.53.034-2.769-.82-2.786-1.86.0-1.065 1.202-1.932 2.733-1.958 1.522-.03 2.768.818 2.768 1.868zm10.555-.405c.182 1.03-.875 2.088-2.387 2.37-1.485.271-2.861-.365-3.05-1.386-.184-1.056.893-2.114 2.376-2.387 1.514-.263 2.868.356 3.061 1.403z"/></svg>
</a><a href=https://twitter.com/javifm86 class="p-2 text-gray-300 hover:text-white"><span class=sr-only>Twitter</span><svg class="w-8 h-8 mt-1 pointer-events-none" role="img" aria-labelledby="titleId" viewBox="0 0 256 209" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid"><title id="titleId">Twitter</title><path role="presentation" class="fill-current" d="M256 25.45a105.04 105.04.0 01-30.166 8.27c10.845-6.5 19.172-16.793 23.093-29.057a105.183 105.183.0 01-33.351 12.745C205.995 7.201 192.346.822 177.239.822c-29.006.0-52.523 23.516-52.523 52.52.0 4.117.465 8.125 1.36 11.97-43.65-2.191-82.35-23.1-108.255-54.876-4.52 7.757-7.11 16.78-7.11 26.404.0 18.222 9.273 34.297 23.365 43.716a52.312 52.312.0 01-23.79-6.57c-.003.22-.003.44-.003.661.0 25.447 18.104 46.675 42.13 51.5a52.592 52.592.0 01-23.718.9c6.683 20.866 26.08 36.05 49.062 36.475-17.975 14.086-40.622 22.483-65.228 22.483-4.24.0-8.42-.249-12.529-.734 23.243 14.902 50.85 23.597 80.51 23.597 96.607.0 149.434-80.031 149.434-149.435.0-2.278-.05-4.543-.152-6.795A106.748 106.748.0 00256 25.45"/></svg></a></div></div></footer></div></div><script src=https://javifm.com/js/focus-visible.min.js></script><script type=text/javascript>(function(){const n=document.getElementsByTagName("body")[0],a=document.getElementById("open-menu"),i=document.getElementById("close-menu"),o=document.getElementById("site-menu"),s=document.getElementById("sidebar-open"),t="show-nav";let e="closed";const d=h(function(){n.classList.contains(t)&&window.screen.width>639&&r()},0);s.addEventListener("click",r),window.addEventListener("resize",d);function u(){e==="opening"?(c(a,"hidden"),l(i,"hidden"),s.setAttribute("aria-label","Cerrar menú"),e="open"):(l(a,"hidden"),c(i,"hidden"),o.classList.add("hidden"),s.setAttribute("aria-label","Abrir menú"),e="closed")}function r(){n.classList.contains(t)?(n.classList.remove(t),e="closing"):(n.classList.add(t),e="opening",o.classList.remove("hidden")),setTimeout(u,300)}function h(e,t,n){let s;return function(){let o=this,i=arguments;const a=function(){s=null,n||e.apply(o,i)};let r=n&&!s;clearTimeout(s),s=setTimeout(a,t),r&&e.apply(o,i)}}function c(e,t){e.setAttribute("class",e.getAttribute("class")+" "+t)}function l(e,t){let n=e.getAttribute("class").replace(new RegExp("(\\s|^)"+t+"(\\s|$)","g"),"$2");e.setAttribute("class",n)}})()</script><script type=text/javascript>(function(){const c=document.getElementById("desktopContainerLanguageSelector"),f=document.getElementById("mobileContainerLanguageSelector"),e=document.getElementById("desktopLanguageList"),t=document.getElementById("mobileLanguageList"),n=document.getElementById("desktopButtonLanguageSelector"),s=document.getElementById("mobileButtonLanguageSelector"),d=document.querySelectorAll("#desktopLanguageList li, #mobileLanguageList li"),l=document.querySelectorAll("#desktopLanguageList li"),r=document.querySelectorAll("#mobileLanguageList li");n.addEventListener("click",function(){e.classList.toggle("hidden")}),s.addEventListener("click",function(){t.classList.toggle("hidden")}),d.forEach(e=>{e.addEventListener("click",function(){window.location.href=this.dataset.url}),e.addEventListener("keypress",function({key:e}){(e==="Enter"||e==="Space")&&(window.location.href=this.dataset.url)})}),document.addEventListener("click",function(n){!c.contains(n.target)&&o()&&e.classList.add("hidden"),!f.contains(n.target)&&a()&&t.classList.add("hidden")}),document.addEventListener("keydown",function(e){const{key:t}=e,n=o(),s=a();if(!n&&!s)return;if(t==="Escape"||t==="Tab"){u(n);return}if(t==="ArrowUp"){e.preventDefault(),document.activeElement.previousElementSibling!==null&&document.activeElement.previousElementSibling.focus();return}if(t==="ArrowDown"){e.preventDefault(),h()?l[0].focus():m()?r[0].focus():i()&&document.activeElement.nextElementSibling!==null&&document.activeElement.nextElementSibling.focus();return}});function o(){return!e.classList.contains("hidden")}function a(){return!t.classList.contains("hidden")}function u(o){let a=null,r=null;o?(a=e,r=n):(a=t,r=s),a.classList.add("hidden"),i()&&r.focus()}function h(){return document.activeElement.isSameNode(n)}function m(){return document.activeElement.isSameNode(s)}function i(){return document.activeElement.getAttribute("id").includes("listbox-option-")}function p(e){return e.getAttribute("id").includes("listbox-option-")}})()</script></body></html>